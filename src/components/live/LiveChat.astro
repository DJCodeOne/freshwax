---
// src/components/live/LiveChat.astro
// Live stream chat with emoji picker, GIF support, and online users
---

<div class="chat-section">
    <div class="chat-header">
      <h3>LIVE CHAT</h3>
      <span class="chat-viewers" id="chatViewers">0 watching</span>
    </div>

    <div class="chat-messages" id="chatMessages">
    </div>

    <div id="chatInputSection" class="chat-input-section" style="position: relative;">
    <div id="loginPrompt" class="login-prompt">
      <p><a href="/login">Sign in</a> to chat</p>
    </div>

    <div id="chatForm" class="chat-form hidden">
      <div id="replyIndicator" class="reply-indicator" style="display: none;"></div>

      <!-- Emoji Picker Panel -->
      <div id="emojiPanel" class="emoji-panel" style="display: none;">
        <div class="emoji-panel-header">
          <span>Emojis</span>
          <button type="button" class="emoji-panel-close" id="closeEmojiPanel">Ã—</button>
        </div>
        <div class="emoji-panel-cats">
          <button class="emoji-panel-cat active" data-category="music">ðŸŽµ</button>
          <button class="emoji-panel-cat" data-category="fire">ðŸ”¥</button>
          <button class="emoji-panel-cat" data-category="faces">ðŸ˜Ž</button>
          <button class="emoji-panel-cat" data-category="vibes">ðŸŒ´</button>
        </div>
        <div class="emoji-panel-grid" id="emojiPanelGrid"></div>
      </div>

      <div class="chat-input-wrapper">
        <input type="text" id="chatInput" placeholder="Say something..." maxlength="500" autocomplete="off" />
        <button type="button" id="openEmojiPanel" class="chat-tool-btn" title="Emojis" onclick="window.toggleEmojiPanel && window.toggleEmojiPanel()">ðŸ˜€</button>
        <button type="button" id="openGifModal" class="chat-tool-btn" title="GIFs" onclick="window.toggleGifModal && window.toggleGifModal()">GIF</button>
        <button type="submit" id="sendBtn">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- DM Modal -->
<div id="dmModal" class="dm-modal-bg" style="display: none;">
  <div class="dm-modal-box">
    <div class="dm-modal-header">
      <span>Message <strong id="dmRecipientName"></strong></span>
      <button type="button" id="closeDmModal" class="dm-modal-close">Ã—</button>
    </div>
    <div class="dm-modal-body">
      <textarea id="dmMessageInput" placeholder="Type your message..." maxlength="500"></textarea>
    </div>
    <div class="dm-modal-footer">
      <button type="button" id="sendDmBtn" class="dm-send-btn">Send Message</button>
    </div>
  </div>
</div>

<!-- GIF Modal -->
<div id="gifModal" class="gif-modal-bg" style="display: none;">
  <div class="gif-modal-box">
    <div class="gif-modal-top">
      <h2>Choose a GIF</h2>
      <button type="button" id="closeGifModal" class="gif-modal-x">Ã—</button>
    </div>
    <div class="gif-modal-search-box">
      <input type="text" id="gifSearchInput" placeholder="Search GIFs..." />
    </div>
    <div class="gif-modal-cats">
      <button class="gif-modal-cat active" data-category="trending">Trending</button>
      <button class="gif-modal-cat" data-category="reactions">Reactions</button>
      <button class="gif-modal-cat" data-category="music">Music</button>
      <button class="gif-modal-cat" data-category="dance">Dance</button>
      <button class="gif-modal-cat" data-category="party">Party</button>
    </div>
    <div class="gif-modal-results" id="gifResults">
      <p class="gif-modal-loading">Loading GIFs...</p>
    </div>
    <div class="gif-modal-bottom">
      <span>Powered by GIPHY</span>
    </div>
  </div>
</div>

<script>
// Simple self-contained emoji/GIF picker
(function() {
  const EMOJIS = {
    music: ['ðŸŽµ', 'ðŸŽ¶', 'ðŸŽ¤', 'ðŸŽ§', 'ðŸŽ¹', 'ðŸŽ¸', 'ðŸ¥', 'ðŸŽº', 'ðŸŽ·', 'ðŸª˜', 'ðŸ’¿', 'ðŸ“€', 'ðŸ”Š', 'ðŸ”‰', 'ðŸŽ¼', 'ðŸŽ»', 'ðŸª—', 'ðŸ“»', 'ðŸŽšï¸', 'ðŸŽ›ï¸', 'ðŸŽ™ï¸', 'ðŸ“¯', 'ðŸª•', 'ðŸŽ­'],
    fire: ['ðŸ”¥', 'ðŸ’¥', 'âš¡', 'âœ¨', 'ðŸ’«', 'ðŸŒŸ', 'â­', 'ðŸ’¯', 'ðŸš€', 'ðŸ’ª', 'ðŸ‘Š', 'ðŸ‘', 'ðŸ™Œ', 'ðŸ¤˜', 'âœŒï¸', 'ðŸ‘', 'ðŸŽ¯', 'ðŸ’Ž', 'ðŸ†', 'ðŸ‘‘', 'ðŸ¥‡', 'âš”ï¸', 'ðŸ›¡ï¸', 'ðŸ’£'],
    faces: ['ðŸ˜€', 'ðŸ˜Ž', 'ðŸ¤©', 'ðŸ˜', 'ðŸ¥³', 'ðŸ¤¯', 'ðŸ˜±', 'ðŸ¥µ', 'ðŸ¤¤', 'ðŸ˜', 'ðŸ˜ˆ', 'ðŸ‘€', 'ðŸ’€', 'ðŸ¤–', 'ðŸ‘½', 'ðŸŽƒ', 'ðŸ™ƒ', 'ðŸ˜œ', 'ðŸ¤ª', 'ðŸ˜‚', 'ðŸ¥¹', 'ðŸ˜­', 'ðŸ« ', 'ðŸ¤‘'],
    vibes: ['ðŸŒ´', 'ðŸŒŠ', 'ðŸŒ…', 'ðŸŒ™', 'ðŸŒˆ', 'â˜€ï¸', 'ðŸ¹', 'ðŸ»', 'ðŸ¥‚', 'ðŸ’œ', 'ðŸ’™', 'ðŸ’š', 'ðŸ’›', 'ðŸ§¡', 'â¤ï¸', 'ðŸ–¤', 'ðŸŒº', 'ðŸ€', 'ðŸŒ¸', 'ðŸ¦‹', 'ðŸŒ ', 'ðŸŽª', 'ðŸŽ¡', 'ðŸŽ¢']
  };

  let currentCategory = 'music';
  let gifSearchTimeout = null;
  let documentClickListenerSet = false;
  let onlineUsersIntervalId = null;

  // Send GIF using existing globals from live-stream.js
  async function sendGifToChat(giphyUrl, giphyId) {
    console.log('[GIF] sendGifToChat called:', { giphyUrl, giphyId });

    // Use existing globals set by live-stream.js
    const streamId = window.currentStreamId;
    const auth = window.firebaseAuth;
    const user = auth?.currentUser;

    console.log('[GIF] streamId:', streamId, 'user:', !!user);

    if (!user) {
      console.error('[GIF] No current user');
      alert('Please log in to send GIFs');
      return;
    }
    if (!streamId) {
      console.error('[GIF] No current stream');
      alert('No active stream');
      return;
    }

    try {
      const response = await fetch('/api/livestream/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          streamId: streamId,
          userId: user.uid,
          userName: user.displayName || user.email?.split('@')[0] || 'User',
          message: '[GIF]',
          type: 'giphy',
          giphyUrl,
          giphyId
        })
      });
      console.log('[GIF] Sent successfully:', response.ok);
    } catch (error) {
      console.error('[GIF] Error sending:', error);
    }
  }

  // Wait for DOM
  function init() {
    const emojiBtn = document.getElementById('openEmojiPanel');
    const emojiPanel = document.getElementById('emojiPanel');
    const closeEmoji = document.getElementById('closeEmojiPanel');
    const emojiGrid = document.getElementById('emojiPanelGrid');
    const chatInput = document.getElementById('chatInput');

    const gifBtn = document.getElementById('openGifModal');
    const gifModal = document.getElementById('gifModal');
    const closeGif = document.getElementById('closeGifModal');
    const gifResults = document.getElementById('gifResults');
    const gifSearch = document.getElementById('gifSearchInput');

    if (!emojiBtn || !emojiPanel) {
      console.log('[Picker] Elements not found, retrying...');
      setTimeout(init, 500);
      return;
    }

    console.log('[Picker] Initializing fresh picker buttons');

    // Render emojis
    function renderEmojis(cat) {
      const emojis = EMOJIS[cat] || EMOJIS.music;
      emojiGrid.innerHTML = emojis.map(e =>
        `<button type="button" class="emoji-grid-btn">${e}</button>`
      ).join('');

      emojiGrid.querySelectorAll('.emoji-grid-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          if (chatInput) chatInput.value += btn.textContent;
          chatInput?.focus();
        });
      });
    }

    // Expose toggle functions globally for onclick handlers
    window.toggleEmojiPanel = function() {
      console.log('[Picker] Emoji toggle called');
      const isVisible = emojiPanel.style.display !== 'none';
      emojiPanel.style.display = isVisible ? 'none' : 'block';
      if (!isVisible) renderEmojis(currentCategory);
    };

    window.toggleGifModal = function() {
      console.log('[Picker] GIF toggle called');
      gifModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
      loadGifs('trending');
    };

    // Close emoji panel
    closeEmoji?.addEventListener('click', () => {
      emojiPanel.style.display = 'none';
    });

    // Emoji category buttons
    document.querySelectorAll('.emoji-panel-cat').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.emoji-panel-cat').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = btn.dataset.category;
        renderEmojis(currentCategory);
      });
    });

    // Close GIF modal
    closeGif?.addEventListener('click', () => {
      gifModal.style.display = 'none';
      document.body.style.overflow = '';
    });

    // Click outside to close GIF modal
    gifModal?.addEventListener('click', (e) => {
      if (e.target === gifModal) {
        gifModal.style.display = 'none';
        document.body.style.overflow = '';
      }
    });

    // GIF category buttons
    document.querySelectorAll('.gif-modal-cat').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.gif-modal-cat').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        loadGifs(btn.dataset.category);
      });
    });

    // GIF search
    gifSearch?.addEventListener('input', (e) => {
      clearTimeout(gifSearchTimeout);
      gifSearchTimeout = setTimeout(() => {
        const query = e.target.value.trim();
        if (query) {
          loadGifs(null, query);
        } else {
          loadGifs('trending');
        }
      }, 400);
    });

    // Load GIFs from Giphy
    async function loadGifs(category, searchQuery = null) {
      const apiKey = window.GIPHY_API_KEY || 'p0USqLUVxus8d82HAcPhQ2GqG6SfraYr';
      console.log('[GIF] Loading GIFs, apiKey available:', !!apiKey, 'category:', category, 'query:', searchQuery);
      gifResults.innerHTML = '<p class="gif-modal-loading">Loading GIFs...</p>';

      try {
        let url;
        if (searchQuery) {
          url = `https://api.giphy.com/v1/gifs/search?api_key=${apiKey}&q=${encodeURIComponent(searchQuery)}&limit=24&rating=pg-13`;
        } else if (category === 'trending') {
          url = `https://api.giphy.com/v1/gifs/trending?api_key=${apiKey}&limit=24&rating=pg-13`;
        } else {
          url = `https://api.giphy.com/v1/gifs/search?api_key=${apiKey}&q=${encodeURIComponent(category)}&limit=24&rating=pg-13`;
        }

        console.log('[GIF] Fetching:', url.replace(apiKey, 'KEY'));
        const res = await fetch(url);
        console.log('[GIF] Response status:', res.status);

        if (!res.ok) {
          const errText = await res.text();
          console.error('[GIF] API error:', res.status, errText);
          gifResults.innerHTML = `<p class="gif-modal-loading">API error: ${res.status}</p>`;
          return;
        }

        const data = await res.json();
        console.log('[GIF] Got', data.data?.length || 0, 'results');

        if (data.data?.length > 0) {
          gifResults.innerHTML = data.data.map(gif => `
            <div class="gif-result-item" data-url="${gif.images.fixed_height.url}" data-id="${gif.id}">
              <img src="${gif.images.fixed_height_small.url}" alt="${gif.title}" loading="lazy" />
            </div>
          `).join('');

          gifResults.querySelectorAll('.gif-result-item').forEach(item => {
            item.addEventListener('click', () => {
              console.log('[GIF] Selected:', item.dataset.url);
              // Send GIF using local function
              sendGifToChat(item.dataset.url, item.dataset.id);
              gifModal.style.display = 'none';
              document.body.style.overflow = '';
            });
          });
        } else {
          gifResults.innerHTML = '<p class="gif-modal-loading">No GIFs found</p>';
        }
      } catch (err) {
        console.error('[GIF] Error:', err);
        gifResults.innerHTML = '<p class="gif-modal-loading">Error loading GIFs</p>';
      }
    }

    // Click outside emoji panel to close (only add once to prevent duplicates on View Transitions)
    if (!documentClickListenerSet) {
      document.addEventListener('click', (e) => {
        const panel = document.getElementById('emojiPanel');
        const btn = document.getElementById('openEmojiPanel');
        if (panel && panel.style.display !== 'none' &&
            !panel.contains(e.target) &&
            e.target !== btn) {
          panel.style.display = 'none';
        }
      });
      documentClickListenerSet = true;
    }

    // Initialize with music emojis
    renderEmojis('music');

    // Setup DM modal
    const dmModal = document.getElementById('dmModal');
    const closeDmBtn = document.getElementById('closeDmModal');
    const sendDmBtn = document.getElementById('sendDmBtn');
    const dmInput = document.getElementById('dmMessageInput');
    const dmRecipientName = document.getElementById('dmRecipientName');
    let currentDmRecipient = null;

    closeDmBtn?.addEventListener('click', () => {
      dmModal.style.display = 'none';
      dmInput.value = '';
      currentDmRecipient = null;
    });

    dmModal?.addEventListener('click', (e) => {
      if (e.target === dmModal) {
        dmModal.style.display = 'none';
        dmInput.value = '';
        currentDmRecipient = null;
      }
    });

    sendDmBtn?.addEventListener('click', async () => {
      const message = dmInput.value.trim();
      if (!message || !currentDmRecipient) return;

      const auth = window.firebaseAuth;
      const user = auth?.currentUser;
      if (!user) {
        alert('Please log in to send messages');
        return;
      }

      try {
        const response = await fetch('/api/livestream/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            streamId: window.currentStreamId,
            userId: user.uid,
            userName: user.displayName || user.email?.split('@')[0] || 'User',
            message: `@${currentDmRecipient.name}: ${message}`,
            type: 'dm',
            recipientId: currentDmRecipient.id
          })
        });
        if (response.ok) {
          dmModal.style.display = 'none';
          dmInput.value = '';
          currentDmRecipient = null;
        }
      } catch (err) {
        console.error('[DM] Error sending:', err);
      }
    });

    // Expose openDM function globally
    window.openDmModal = function(userId, userName) {
      currentDmRecipient = { id: userId, name: userName };
      dmRecipientName.textContent = userName;
      dmModal.style.display = 'flex';
      dmInput.focus();
    };
  }

  // Online users tracking
  function initOnlineUsers() {
    const usersList = document.getElementById('onlineUsersList');
    const userCount = document.getElementById('onlineUserCount');
    if (!usersList) return;

    // Update online users from Pusher presence or viewer data
    window.updateOnlineUsers = function(users) {
      if (!users || users.length === 0) {
        usersList.innerHTML = '<p class="no-users-msg">No users online</p>';
        userCount.textContent = '0';
        return;
      }

      userCount.textContent = users.length.toString();
      usersList.innerHTML = users.map(user => {
        const initial = (user.name || 'U').charAt(0).toUpperCase();
        const avatarContent = user.avatar
          ? `<img src="${user.avatar}" alt="${user.name}" />`
          : initial;
        return `
          <div class="online-user-item" onclick="window.openDmModal && window.openDmModal('${user.id}', '${user.name.replace(/'/g, "\\'")}')">
            <div class="online-user-avatar">${avatarContent}</div>
            <span class="online-user-name">${user.name}</span>
          </div>
        `;
      }).join('');
    };

    // Poll for online users (connected to existing viewer system)
    // Clear any existing interval to prevent duplicates on View Transitions
    if (onlineUsersIntervalId) {
      clearInterval(onlineUsersIntervalId);
    }
    onlineUsersIntervalId = setInterval(() => {
      if (window.getOnlineViewers) {
        const viewers = window.getOnlineViewers();
        window.updateOnlineUsers(viewers);
      }
    }, 5000);
  }

  // Run on load and on Astro navigation
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => { init(); initOnlineUsers(); });
  } else {
    init();
    initOnlineUsers();
  }
  document.addEventListener('astro:page-load', () => { init(); initOnlineUsers(); });
})();
</script>

<style is:global>
  /* DM Modal */
  .dm-modal-bg {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }

  .dm-modal-box {
    background: #1a1a1a;
    border-radius: 12px;
    width: 100%;
    max-width: 400px;
    border: 1px solid #333;
  }

  .dm-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid #333;
    color: #fff;
    font-size: 0.9375rem;
  }

  .dm-modal-header strong {
    color: #6366f1;
  }

  .dm-modal-close {
    background: none;
    border: none;
    color: #888;
    font-size: 1.5rem;
    cursor: pointer;
    line-height: 1;
  }

  .dm-modal-close:hover { color: #fff; }

  .dm-modal-body {
    padding: 1rem;
  }

  .dm-modal-body textarea {
    width: 100%;
    height: 100px;
    background: #111;
    border: 1px solid #333;
    border-radius: 8px;
    color: #fff;
    padding: 0.75rem;
    font-size: 0.9375rem;
    resize: none;
  }

  .dm-modal-body textarea:focus {
    outline: none;
    border-color: #6366f1;
  }

  .dm-modal-footer {
    padding: 1rem;
    border-top: 1px solid #333;
    text-align: right;
  }

  .dm-send-btn {
    background: #6366f1;
    color: #fff;
    border: none;
    padding: 0.625rem 1.25rem;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    font-size: 0.875rem;
  }

  .dm-send-btn:hover {
    background: #5558e3;
  }

  /* Hide sidebar on mobile */
  @media (max-width: 768px) {
    .online-users-sidebar {
      display: none;
    }
  }

  /* Emoji Panel - Fixed position like GIF modal */
  .emoji-panel {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    width: 400px;
    max-width: 95vw;
    background: #1a1a1a;
    border: 2px solid #444;
    border-radius: 12px;
    z-index: 9999;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.6);
  }

  .emoji-panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: #222;
    border-bottom: 1px solid #333;
    border-radius: 10px 10px 0 0;
    font-weight: 600;
    color: #fff;
    font-size: 0.875rem;
  }

  .emoji-panel-close {
    background: none;
    border: none;
    color: #888;
    font-size: 1.25rem;
    cursor: pointer;
    line-height: 1;
  }

  .emoji-panel-close:hover { color: #fff; }

  .emoji-panel-cats {
    display: flex;
    gap: 0.25rem;
    padding: 0.5rem;
    background: #1a1a1a;
    border-bottom: 1px solid #333;
  }

  .emoji-panel-cat {
    padding: 0.375rem 0.5rem;
    background: #2a2a2a;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    cursor: pointer;
  }

  .emoji-panel-cat:hover,
  .emoji-panel-cat.active {
    background: #6366f1;
  }

  .emoji-panel-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 0.5rem;
    padding: 1rem;
  }

  .emoji-grid-btn {
    padding: 0.625rem;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    border-radius: 6px;
    text-align: center;
  }

  .emoji-grid-btn:hover {
    background: rgba(99, 102, 241, 0.3);
  }

  /* Chat tool buttons */
  .chat-tool-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: #2a2a2a;
    border: none;
    border-radius: 6px;
    color: #aaa;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 700;
    transition: all 0.15s;
  }

  .chat-tool-btn:hover {
    background: #6366f1;
    color: #fff;
  }

  /* GIF Modal */
  .gif-modal-bg {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }

  .gif-modal-box {
    background: #1a1a1a;
    border-radius: 16px;
    width: 100%;
    max-width: 550px;
    max-height: 70vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    border: 1px solid #333;
  }

  .gif-modal-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid #333;
    background: #222;
    border-radius: 16px 16px 0 0;
  }

  .gif-modal-top h2 {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
    color: #fff;
  }

  .gif-modal-x {
    background: none;
    border: none;
    color: #888;
    font-size: 1.75rem;
    cursor: pointer;
    line-height: 1;
  }

  .gif-modal-x:hover { color: #fff; }

  .gif-modal-search-box {
    padding: 0.75rem 1.25rem;
    background: #1a1a1a;
    border-bottom: 1px solid #333;
  }

  .gif-modal-search-box input {
    width: 100%;
    padding: 0.75rem 1rem;
    background: #111;
    border: 2px solid #333;
    border-radius: 8px;
    color: #fff;
    font-size: 0.9375rem;
  }

  .gif-modal-search-box input:focus {
    outline: none;
    border-color: #6366f1;
  }

  .gif-modal-cats {
    display: flex;
    gap: 0.375rem;
    padding: 0.625rem 1.25rem;
    background: #1a1a1a;
    border-bottom: 1px solid #333;
    flex-wrap: wrap;
  }

  .gif-modal-cat {
    padding: 0.375rem 0.75rem;
    background: #2a2a2a;
    border: none;
    border-radius: 16px;
    font-size: 0.8125rem;
    cursor: pointer;
    color: #aaa;
    font-weight: 500;
  }

  .gif-modal-cat:hover { background: #3a3a3a; color: #fff; }
  .gif-modal-cat.active { background: #6366f1; color: #fff; }

  .gif-modal-results {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.75rem;
    padding: 1rem;
    overflow-y: auto;
    flex: 1;
    min-height: 200px;
  }

  .gif-result-item {
    position: relative;
    width: 100%;
    padding-bottom: 100%;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    background: #222;
    border: 2px solid #333;
  }

  .gif-result-item:hover {
    border-color: #6366f1;
    transform: scale(1.02);
  }

  .gif-result-item img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .gif-modal-loading {
    grid-column: 1 / -1;
    text-align: center;
    color: #666;
    padding: 2rem;
    margin: 0;
  }

  .gif-modal-bottom {
    padding: 0.5rem 1.25rem;
    background: #222;
    border-top: 1px solid #333;
    border-radius: 0 0 16px 16px;
    text-align: right;
    font-size: 0.75rem;
    color: #666;
  }

  /* Reply Indicator */
  .reply-indicator {
    display: flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: #1a1a2e;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    font-size: 0.8125rem;
    gap: 0.25rem;
  }
</style>
