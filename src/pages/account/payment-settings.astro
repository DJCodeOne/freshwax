---
// src/pages/account/payment-settings.astro
// Unified payment settings for all vendor types (artists, merch suppliers, vinyl sellers)

import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export const prerender = false;

// Get URL params for return states
const url = new URL(Astro.request.url);
const stripeConnected = url.searchParams.get('stripe_connected') === 'true';
const stripeRefresh = url.searchParams.get('stripe_refresh') === 'true';
---

<Layout title="Payment Settings | Fresh Wax" noindex={true}>
  <Header />

  <main class="payment-settings">
    <div class="container">
      <div id="loading-state" class="loading-state">
        <div class="spinner"></div>
        <p>Loading payment settings...</p>
      </div>

      <div id="auth-required" class="auth-required" style="display: none;">
        <h1>Sign In Required</h1>
        <p>Please sign in to access your payment settings.</p>
        <a href="/login?redirect=/account/payment-settings" class="btn btn-primary">Sign In</a>
      </div>

      <div id="not-vendor" class="not-vendor" style="display: none;">
        <h1>Not a Vendor</h1>
        <p>Payment settings are only available for artists, merch suppliers, and vinyl sellers.</p>
        <p>If you'd like to sell on Fresh Wax, visit your dashboard to apply.</p>
        <a href="/account/dashboard" class="btn btn-primary">Go to Dashboard</a>
      </div>

      <div id="main-content" class="main-content" style="display: none;">
        <div class="page-header">
          <a href="/account/dashboard" class="back-link">&larr; Back to Dashboard</a>
          <h1>Payment Settings</h1>
          <p class="subtitle">Set up how you receive payments for your sales on Fresh Wax.</p>
        </div>

        {stripeConnected && (
          <div class="success-banner">
            <span>&#10003;</span> Stripe Connect setup completed successfully!
          </div>
        )}

        {stripeRefresh && (
          <div class="warning-banner">
            <span>&#9888;</span> Your Stripe session expired. Please continue setup below.
          </div>
        )}

        <!-- Vendor Roles Badge -->
        <div class="vendor-roles" id="vendor-roles"></div>

        <!-- Payment Setup Section -->
        <section class="connect-section">
          <h2>Payment Method</h2>
          <div class="payout-method-indicator" id="payout-method-indicator"></div>

          <!-- Payout Method Tabs -->
          <div class="payout-tabs">
            <button class="payout-tab active" data-tab="stripe">
              <span class="tab-icon">&#128179;</span> Stripe
              <span class="tab-check" id="stripe-check" style="display:none">&#10003;</span>
            </button>
            <button class="payout-tab" data-tab="paypal">
              <span class="tab-icon">P</span> PayPal
              <span class="tab-check" id="paypal-check" style="display:none">&#10003;</span>
            </button>
          </div>

          <!-- Stripe Tab -->
          <div class="payout-tab-content active" id="stripe-tab">
            <div id="connect-status" class="connect-status">
              <div class="status-loading">Checking Stripe status...</div>
            </div>
          </div>

          <!-- PayPal Tab -->
          <div class="payout-tab-content" id="paypal-tab">
            <div id="paypal-status" class="connect-status">
              <div class="status-loading">Checking PayPal status...</div>
            </div>
          </div>
        </section>

        <!-- Earnings Summary -->
        <section class="earnings-section">
          <h2>Earnings Summary</h2>
          <div class="earnings-cards">
            <div class="earnings-card">
              <span class="label">Total Earned</span>
              <span class="amount" id="total-earned">£0.00</span>
            </div>
            <div class="earnings-card">
              <span class="label">This Month</span>
              <span class="amount" id="this-month">£0.00</span>
            </div>
            <div class="earnings-card pending">
              <span class="label">Pending</span>
              <span class="amount" id="pending-amount">£0.00</span>
            </div>
          </div>

          <!-- Role-specific earnings breakdown -->
          <div class="earnings-breakdown" id="earnings-breakdown"></div>
        </section>

        <!-- Recent Payouts -->
        <section class="payouts-section">
          <h2>Recent Payouts</h2>
          <div id="payouts-list" class="payouts-list">
            <p class="no-payouts">No payouts yet</p>
          </div>
        </section>

        <!-- How It Works -->
        <section class="help-section">
          <h2>How Payments Work</h2>
          <div class="help-content">
            <div class="help-item">
              <span class="help-icon">1</span>
              <div>
                <strong>Customer Buys</strong>
                <p>When a customer purchases your item, Fresh Wax handles the payment securely.</p>
              </div>
            </div>
            <div class="help-item">
              <span class="help-icon">2</span>
              <div>
                <strong>Automatic Split</strong>
                <p>Your share is calculated automatically. Artists get ~92%, vinyl sellers get 85%, merch suppliers get their cost price.</p>
              </div>
            </div>
            <div class="help-item">
              <span class="help-icon">3</span>
              <div>
                <strong>Instant Payout</strong>
                <p>Your earnings are sent instantly to your preferred payment method - Stripe or PayPal.</p>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <Footer />
</Layout>

<script>
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
  import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';

  // Initialize Firebase
  const firebaseConfig = {
    apiKey: import.meta.env.PUBLIC_FIREBASE_API_KEY || 'AIzaSyBiZGsWdvA9ESm3OsUpZ-VQpwqMjMpBY6g',
    authDomain: "freshwax-store.firebaseapp.com",
    projectId: "freshwax-store",
    storageBucket: "freshwax-store.firebasestorage.app",
    messagingSenderId: "632122501684",
    appId: "1:632122501684:web:a6f3ca1a6c9d7a7a7a7a7a"
  };

  const app = initializeApp(firebaseConfig, 'payment-settings');
  const auth = getAuth(app);

  let currentUserId: string | null = null;
  let userData: any = {};
  let vendorRoles: string[] = [];

  async function init() {
    const loadingState = document.getElementById('loading-state');
    const authRequired = document.getElementById('auth-required');
    const notVendor = document.getElementById('not-vendor');
    const mainContent = document.getElementById('main-content');

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        loadingState!.style.display = 'none';
        authRequired!.style.display = 'block';
        return;
      }

      currentUserId = user.uid;

      try {
        // First check user's roles
        const userRes = await fetch(`/api/user/roles?userId=${user.uid}`);
        const userRolesData = await userRes.json();

        // Determine vendor roles
        vendorRoles = [];
        const roles = userRolesData.roles || {};

        if (roles.artist === true) vendorRoles.push('artist');
        if (roles.merchSupplier === true) vendorRoles.push('merchSupplier');
        if (roles.vinylSeller === true) vendorRoles.push('vinylSeller');

        // Also check artists collection for legacy data
        if (vendorRoles.length === 0) {
          const artistRes = await fetch(`/api/artist/check?userId=${user.uid}`);
          const artistData = await artistRes.json();
          if (artistData.isArtist) vendorRoles.push('artist');
          if (artistData.isMerchSupplier) vendorRoles.push('merchSupplier');
          if (artistData.isVinylSeller) vendorRoles.push('vinylSeller');
        }

        // If not a vendor, show message
        if (vendorRoles.length === 0) {
          loadingState!.style.display = 'none';
          notVendor!.style.display = 'block';
          return;
        }

        // Get payment status - use unified endpoint
        const paymentRes = await fetch(`/api/payment/status?userId=${user.uid}`);
        const paymentData = await paymentRes.json();

        // Store combined data
        userData = paymentData;

        // Hide loading, show content
        loadingState!.style.display = 'none';
        mainContent!.style.display = 'block';

        // Show vendor roles
        showVendorRoles();

        // Update Stripe status
        updateStripeStatus(paymentData);

        // Update PayPal status
        updatePayPalStatus(paymentData);

        // Update preferred method indicator
        updateMethodIndicator(paymentData.payoutMethod, paymentData.stripeConnected, paymentData.paypalLinked);

        // Show check marks on tabs
        if (paymentData.stripeConnected) {
          document.getElementById('stripe-check')!.style.display = 'inline';
        }
        if (paymentData.paypalLinked) {
          document.getElementById('paypal-check')!.style.display = 'inline';
        }

        // Update earnings
        updateEarnings(paymentData.earnings || {});

        // Update payouts list
        if (paymentData.payouts || paymentData.pendingPayouts) {
          updatePayoutsList(paymentData.payouts || [], paymentData.pendingPayouts || []);
        }

      } catch (error) {
        console.error('Failed to load payment settings:', error);
        loadingState!.style.display = 'none';
        mainContent!.style.display = 'block';

        // Show basic UI even if API calls fail
        updateStripeStatus({ status: 'not_started' });
        updatePayPalStatus({ paypalLinked: false });
      }
    });
  }

  function showVendorRoles() {
    const rolesEl = document.getElementById('vendor-roles');
    const roleLabels: Record<string, string> = {
      artist: 'Artist',
      merchSupplier: 'Merch Supplier',
      vinylSeller: 'Vinyl Seller'
    };

    const badges = vendorRoles.map(role =>
      `<span class="role-badge ${role}">${roleLabels[role] || role}</span>`
    ).join('');

    rolesEl!.innerHTML = `<span class="roles-label">Your vendor roles:</span> ${badges}`;
  }

  function updateMethodIndicator(method: string | null, stripeActive: boolean, paypalLinked: boolean) {
    const indicator = document.getElementById('payout-method-indicator');
    if (stripeActive || paypalLinked) {
      const preferredMethod = method === 'paypal' ? 'PayPal' : 'Stripe';
      indicator!.innerHTML = `Preferred: <strong>${preferredMethod}</strong>`;
      indicator!.style.display = 'block';
    }
  }

  function updateStripeStatus(data: any) {
    const statusEl = document.getElementById('connect-status');
    const status = data.stripeStatus || data.status || 'not_started';

    if (status === 'active' || data.stripeConnected) {
      statusEl!.innerHTML = `
        <div class="status-active">
          <span class="status-icon">&#10003;</span>
          <div>
            <strong>Stripe Connected</strong>
            <p>Payments will be sent to your connected account automatically.</p>
          </div>
          <div class="status-actions-col">
            <a href="https://dashboard.stripe.com/express" target="_blank" class="btn btn-secondary">
              Stripe Dashboard &rarr;
            </a>
            ${userData.payoutMethod !== 'stripe' && userData.paypalLinked ?
              '<button id="set-stripe-preferred" class="btn btn-primary">Set as Preferred</button>' : ''}
          </div>
        </div>
      `;

      document.getElementById('set-stripe-preferred')?.addEventListener('click', () => setPreferred('stripe'));
    } else if (status === 'onboarding' || status === 'restricted') {
      statusEl!.innerHTML = `
        <div class="status-incomplete">
          <span class="status-icon">&#9888;</span>
          <div>
            <strong>${status === 'restricted' ? 'Action Required' : 'Setup Incomplete'}</strong>
            <p>${status === 'restricted'
              ? 'Stripe requires additional information. Please update your account.'
              : 'Complete your Stripe setup to receive payments.'}</p>
          </div>
          <button id="connect-btn" class="btn btn-${status === 'restricted' ? 'warning' : 'primary'}">
            ${status === 'onboarding' ? 'Continue Setup' : 'Update Account'}
          </button>
        </div>
      `;

      document.getElementById('connect-btn')!.addEventListener('click', startStripeConnect);
    } else {
      statusEl!.innerHTML = `
        <div class="status-not-started">
          <span class="status-icon">&#128179;</span>
          <div>
            <strong>Connect with Stripe</strong>
            <p>Link your bank account via Stripe to receive instant payouts for your sales.</p>
            <ul class="benefits-list">
              <li>&#10003; Instant payouts to your bank</li>
              <li>&#10003; Secure payment processing</li>
              <li>&#10003; Track earnings in Stripe Dashboard</li>
            </ul>
          </div>
          <button id="connect-btn" class="btn btn-primary">Connect with Stripe</button>
        </div>
      `;

      document.getElementById('connect-btn')!.addEventListener('click', startStripeConnect);
    }
  }

  function updatePayPalStatus(data: any) {
    const statusEl = document.getElementById('paypal-status');

    if (data.paypalLinked) {
      statusEl!.innerHTML = `
        <div class="status-active">
          <span class="status-icon">&#10003;</span>
          <div>
            <strong>PayPal Connected</strong>
            <p>Payouts will be sent to: <strong>${data.paypalEmail}</strong></p>
          </div>
          <div class="status-actions-col">
            <button id="paypal-change-btn" class="btn btn-secondary">Change Email</button>
            ${data.payoutMethod !== 'paypal' && userData.stripeConnected ?
              '<button id="set-paypal-preferred" class="btn btn-primary">Set as Preferred</button>' : ''}
          </div>
        </div>
      `;

      document.getElementById('paypal-change-btn')?.addEventListener('click', changePayPalEmail);
      document.getElementById('set-paypal-preferred')?.addEventListener('click', () => setPreferred('paypal'));
    } else {
      statusEl!.innerHTML = `
        <div class="status-not-started">
          <span class="status-icon">P</span>
          <div>
            <strong>Link PayPal Account</strong>
            <p>Enter your PayPal email to receive payouts via PayPal instead of Stripe.</p>
            <div class="paypal-form">
              <input type="email" id="paypal-email-input" placeholder="your@paypal-email.com" />
              <button id="paypal-link-btn" class="btn btn-primary">Link PayPal</button>
            </div>
          </div>
        </div>
      `;

      document.getElementById('paypal-link-btn')?.addEventListener('click', linkPayPal);
    }
  }

  function updateEarnings(earnings: any) {
    const totalEarned = earnings.totalPaid || 0;
    const thisMonth = earnings.thisMonthPaid || 0;
    const pending = earnings.totalPending || 0;

    document.getElementById('total-earned')!.textContent = `£${totalEarned.toFixed(2)}`;
    document.getElementById('this-month')!.textContent = `£${thisMonth.toFixed(2)}`;
    document.getElementById('pending-amount')!.textContent = `£${pending.toFixed(2)}`;

    // Show breakdown if multiple roles
    if (vendorRoles.length > 1 && earnings.breakdown) {
      const breakdownEl = document.getElementById('earnings-breakdown');
      let html = '<div class="breakdown-title">Breakdown by role:</div><div class="breakdown-cards">';

      if (earnings.breakdown.artist) {
        html += `<div class="breakdown-card"><span class="breakdown-role">Artist</span><span class="breakdown-amount">£${earnings.breakdown.artist.toFixed(2)}</span></div>`;
      }
      if (earnings.breakdown.merchSupplier) {
        html += `<div class="breakdown-card"><span class="breakdown-role">Merch</span><span class="breakdown-amount">£${earnings.breakdown.merchSupplier.toFixed(2)}</span></div>`;
      }
      if (earnings.breakdown.vinylSeller) {
        html += `<div class="breakdown-card"><span class="breakdown-role">Vinyl</span><span class="breakdown-amount">£${earnings.breakdown.vinylSeller.toFixed(2)}</span></div>`;
      }

      html += '</div>';
      breakdownEl!.innerHTML = html;
    }
  }

  async function startStripeConnect() {
    const btn = document.getElementById('connect-btn') as HTMLButtonElement | null;
    if (btn) {
      btn.disabled = true;
      btn.textContent = 'Loading...';
    }

    try {
      // Use unified endpoint that works for all vendor types
      const res = await fetch('/api/stripe/connect/create-account', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          userId: currentUserId,
          returnUrl: window.location.origin + '/account/payment-settings?stripe_connected=true',
          refreshUrl: window.location.origin + '/account/payment-settings?stripe_refresh=true'
        })
      });

      const data = await res.json();

      if (data.onboardingUrl) {
        window.location.href = data.onboardingUrl;
      } else {
        throw new Error(data.error || 'Failed to start Stripe setup');
      }
    } catch (error: any) {
      alert(error.message);
      if (btn) {
        btn.disabled = false;
        btn.textContent = 'Try Again';
      }
    }
  }

  async function linkPayPal() {
    const input = document.getElementById('paypal-email-input') as HTMLInputElement;
    const btn = document.getElementById('paypal-link-btn') as HTMLButtonElement;
    const email = input?.value?.trim();

    if (!email || !email.includes('@')) {
      alert('Please enter a valid email address');
      return;
    }

    btn.textContent = 'Linking...';
    btn.disabled = true;

    try {
      const res = await fetch('/api/paypal/link-account', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          entityType: 'user',
          entityId: currentUserId,
          paypalEmail: email
        })
      });
      const data = await res.json();

      if (data.success) {
        window.location.reload();
      } else {
        alert(data.error || 'Failed to link PayPal');
        btn.textContent = 'Link PayPal';
        btn.disabled = false;
      }
    } catch (e) {
      alert('Failed to link PayPal');
      btn.textContent = 'Link PayPal';
      btn.disabled = false;
    }
  }

  async function changePayPalEmail() {
    const newEmail = prompt('Enter your new PayPal email:');
    if (!newEmail || !newEmail.includes('@')) {
      if (newEmail !== null) alert('Please enter a valid email');
      return;
    }

    try {
      const res = await fetch('/api/paypal/link-account', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          entityType: 'user',
          entityId: currentUserId,
          paypalEmail: newEmail
        })
      });
      const data = await res.json();
      if (data.success) window.location.reload();
      else alert(data.error || 'Failed to update');
    } catch (e) {
      alert('Failed to update');
    }
  }

  async function setPreferred(method: 'stripe' | 'paypal') {
    try {
      const res = await fetch('/api/paypal/set-payout-method', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          entityType: 'user',
          entityId: currentUserId,
          payoutMethod: method
        })
      });
      const data = await res.json();
      if (data.success) window.location.reload();
      else alert(data.error || 'Failed to set method');
    } catch (e) {
      alert('Failed to set method');
    }
  }

  // Tab switching
  document.querySelectorAll('.payout-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.payout-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.payout-tab-content').forEach(c => c.classList.remove('active'));
      (tab as HTMLElement).classList.add('active');
      const tabName = (tab as HTMLElement).dataset.tab;
      document.getElementById(`${tabName}-tab`)?.classList.add('active');
    });
  });

  function updatePayoutsList(payouts: any[], pending: any[]) {
    const listEl = document.getElementById('payouts-list');

    if ((!payouts || payouts.length === 0) && (!pending || pending.length === 0)) {
      return;
    }

    let html = '';

    // Pending payouts first
    if (pending && pending.length > 0) {
      for (const p of pending) {
        html += `
          <div class="payout-item pending">
            <div class="payout-info">
              <span class="payout-order">Order #${p.orderNumber || p.orderId?.slice(-6).toUpperCase()}</span>
              <span class="payout-type">${p.type || 'Sale'}</span>
              <span class="payout-date">${formatDate(p.createdAt)}</span>
              <span class="payout-status pending">Pending</span>
            </div>
            <span class="payout-amount">£${(p.amount || 0).toFixed(2)}</span>
          </div>
        `;
      }
    }

    // Completed payouts
    if (payouts && payouts.length > 0) {
      for (const p of payouts) {
        html += `
          <div class="payout-item ${p.status}">
            <div class="payout-info">
              <span class="payout-order">Order #${p.orderNumber || p.orderId?.slice(-6).toUpperCase()}</span>
              <span class="payout-type">${p.type || 'Sale'}</span>
              <span class="payout-date">${formatDate(p.completedAt || p.createdAt)}</span>
              <span class="payout-status ${p.status}">${p.status === 'completed' ? 'Paid' : p.status}</span>
            </div>
            <span class="payout-amount">£${(p.amount || 0).toFixed(2)}</span>
          </div>
        `;
      }
    }

    listEl!.innerHTML = html;
  }

  function formatDate(dateStr: string) {
    if (!dateStr) return '';
    return new Date(dateStr).toLocaleDateString('en-GB', {
      day: 'numeric',
      month: 'short',
      year: 'numeric'
    });
  }

  init();
</script>

<style>
  .payment-settings {
    min-height: 100vh;
    padding: 40px 20px;
    background: var(--bg-primary, #0a0a0a);
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
  }

  .loading-state {
    text-align: center;
    padding: 60px 20px;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid #333;
    border-top-color: #dc2626;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .auth-required, .not-vendor {
    text-align: center;
    padding: 60px 20px;
    background: #141414;
    border-radius: 12px;
  }

  .auth-required h1, .not-vendor h1 {
    margin-bottom: 15px;
  }

  .auth-required p, .not-vendor p {
    color: #a3a3a3;
    margin-bottom: 15px;
  }

  .page-header {
    margin-bottom: 25px;
  }

  .back-link {
    color: #a3a3a3;
    text-decoration: none;
    font-size: 0.9rem;
    display: inline-block;
    margin-bottom: 15px;
  }

  .back-link:hover {
    color: white;
  }

  .page-header h1 {
    font-size: 2rem;
    margin-bottom: 8px;
  }

  .subtitle {
    color: #a3a3a3;
  }

  .success-banner, .warning-banner {
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .success-banner {
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.3);
    color: #22c55e;
  }

  .warning-banner {
    background: rgba(245, 158, 11, 0.1);
    border: 1px solid rgba(245, 158, 11, 0.3);
    color: #f59e0b;
  }

  /* Vendor Roles */
  .vendor-roles {
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .roles-label {
    color: #a3a3a3;
    font-size: 0.9rem;
  }

  .role-badge {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .role-badge.artist {
    background: rgba(139, 92, 246, 0.2);
    color: #a78bfa;
    border: 1px solid rgba(139, 92, 246, 0.3);
  }

  .role-badge.merchSupplier {
    background: rgba(59, 130, 246, 0.2);
    color: #60a5fa;
    border: 1px solid rgba(59, 130, 246, 0.3);
  }

  .role-badge.vinylSeller {
    background: rgba(234, 179, 8, 0.2);
    color: #facc15;
    border: 1px solid rgba(234, 179, 8, 0.3);
  }

  section {
    background: #141414;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
  }

  section h2 {
    font-size: 1.25rem;
    margin-bottom: 20px;
  }

  /* Payout Method Tabs */
  .payout-method-indicator {
    display: none;
    margin-bottom: 15px;
    padding: 8px 12px;
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.3);
    border-radius: 6px;
    color: #22c55e;
    font-size: 0.9rem;
  }

  .payout-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    border-bottom: 1px solid #333;
    padding-bottom: 15px;
  }

  .payout-tab {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: #1f1f1f;
    border: 1px solid #333;
    border-radius: 6px;
    color: #a3a3a3;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s;
  }

  .payout-tab:hover {
    background: #262626;
    color: white;
  }

  .payout-tab.active {
    background: #dc2626;
    border-color: #dc2626;
    color: white;
  }

  .tab-icon {
    font-size: 1rem;
  }

  .tab-check {
    color: #22c55e;
    font-weight: bold;
  }

  .payout-tab.active .tab-check {
    color: white;
  }

  .payout-tab-content {
    display: none;
  }

  .payout-tab-content.active {
    display: block;
  }

  .connect-status {
    padding: 15px 0;
  }

  .status-active, .status-incomplete, .status-not-started {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    flex-wrap: wrap;
  }

  .status-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: #1f1f1f;
  }

  .status-active .status-icon {
    color: #22c55e;
    background: rgba(34, 197, 94, 0.2);
  }

  .status-incomplete .status-icon {
    color: #f59e0b;
    background: rgba(245, 158, 11, 0.2);
  }

  .status-not-started .status-icon {
    color: #60a5fa;
    background: rgba(59, 130, 246, 0.2);
  }

  .status-active div, .status-incomplete div, .status-not-started div {
    flex: 1;
    min-width: 200px;
  }

  .status-active p, .status-incomplete p, .status-not-started p {
    color: #a3a3a3;
    font-size: 0.9rem;
    margin-top: 5px;
  }

  .status-actions-col {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .benefits-list {
    list-style: none;
    padding: 0;
    margin: 10px 0 0;
  }

  .benefits-list li {
    color: #e5e7eb;
    font-size: 0.875rem;
    padding: 3px 0;
  }

  /* PayPal Form */
  .paypal-form {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
  }

  .paypal-form input {
    flex: 1;
    min-width: 200px;
    padding: 10px 15px;
    background: #1f1f1f;
    border: 1px solid #333;
    border-radius: 6px;
    color: white;
    font-size: 0.9rem;
  }

  .paypal-form input:focus {
    outline: none;
    border-color: #dc2626;
  }

  .btn {
    display: inline-block;
    padding: 10px 20px;
    border-radius: 6px;
    font-weight: 500;
    text-decoration: none;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s;
  }

  .btn-primary {
    background: #dc2626;
    color: white;
  }

  .btn-primary:hover {
    background: #b91c1c;
  }

  .btn-secondary {
    background: #262626;
    color: white;
  }

  .btn-secondary:hover {
    background: #333;
  }

  .btn-warning {
    background: #f59e0b;
    color: black;
  }

  .btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* Earnings */
  .earnings-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
  }

  .earnings-card {
    background: #1f1f1f;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
  }

  .earnings-card .label {
    display: block;
    color: #a3a3a3;
    font-size: 0.85rem;
    margin-bottom: 8px;
  }

  .earnings-card .amount {
    font-size: 1.5rem;
    font-weight: 700;
    color: #22c55e;
  }

  .earnings-card.pending .amount {
    color: #f59e0b;
  }

  .earnings-breakdown {
    margin-top: 20px;
  }

  .breakdown-title {
    color: #a3a3a3;
    font-size: 0.85rem;
    margin-bottom: 10px;
  }

  .breakdown-cards {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .breakdown-card {
    background: #1f1f1f;
    padding: 10px 15px;
    border-radius: 6px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .breakdown-role {
    font-size: 0.75rem;
    color: #a3a3a3;
    text-transform: uppercase;
  }

  .breakdown-amount {
    font-weight: 600;
    color: white;
  }

  /* Payouts List */
  .payouts-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .no-payouts {
    color: #a3a3a3;
    text-align: center;
    padding: 20px;
  }

  .payout-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: #1f1f1f;
    border-radius: 8px;
  }

  .payout-info {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }

  .payout-order {
    font-weight: 500;
  }

  .payout-type {
    color: #6b7280;
    font-size: 0.8rem;
    padding: 2px 6px;
    background: #262626;
    border-radius: 4px;
  }

  .payout-date {
    color: #a3a3a3;
    font-size: 0.85rem;
  }

  .payout-status {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    text-transform: uppercase;
  }

  .payout-status.completed {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
  }

  .payout-status.pending {
    background: rgba(245, 158, 11, 0.2);
    color: #f59e0b;
  }

  .payout-amount {
    font-weight: 600;
    font-size: 1.1rem;
  }

  .payout-item.completed .payout-amount {
    color: #22c55e;
  }

  .payout-item.pending .payout-amount {
    color: #f59e0b;
  }

  /* Help Section */
  .help-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .help-item {
    display: flex;
    gap: 15px;
    align-items: flex-start;
    padding: 15px;
    background: #1f1f1f;
    border-radius: 8px;
  }

  .help-icon {
    width: 30px;
    height: 30px;
    background: #dc2626;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    flex-shrink: 0;
  }

  .help-item strong {
    display: block;
    margin-bottom: 4px;
  }

  .help-item p {
    color: #a3a3a3;
    font-size: 0.9rem;
    margin: 0;
  }

  @media (max-width: 600px) {
    .page-header h1 {
      font-size: 1.5rem;
    }

    section {
      padding: 20px 15px;
    }

    .status-active, .status-incomplete, .status-not-started {
      flex-direction: column;
      text-align: center;
    }

    .payout-tabs {
      flex-direction: column;
    }

    .payout-tab {
      justify-content: center;
    }

    .paypal-form {
      flex-direction: column;
    }

    .paypal-form input {
      width: 100%;
    }

    .status-actions-col {
      width: 100%;
    }

    .status-actions-col .btn {
      width: 100%;
    }

    .payout-item {
      flex-direction: column;
      gap: 10px;
      text-align: center;
    }

    .vendor-roles {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>
