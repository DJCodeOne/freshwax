<script>
    import { initializeApp } from 'firebase/app';
    import { getAuth, onAuthStateChanged, signOut } from 'firebase/auth';
    import { getFirestore, doc, getDoc } from 'firebase/firestore';

    // Firebase config
    const firebaseConfig = {
        apiKey: import.meta.env.PUBLIC_FIREBASE_API_KEY,
        authDomain: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN,
        projectId: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID,
        storageBucket: import.meta.env.PUBLIC_FIREBASE_STORAGE_BUCKET,
        messagingSenderId: import.meta.env.PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
        appId: import.meta.env.PUBLIC_FIREBASE_APP_ID
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Check authentication
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            await loadArtistData(user.uid);
            document.getElementById('loadingScreen')!.style.display = 'none';
            document.getElementById('mainContent')!.style.display = 'block';
        } else {
            window.location.href = '/artist/login';
        }
    });

    // Load artist data
    async function loadArtistData(userId: string) {
        try {
            const artistDoc = await getDoc(doc(db, 'artists', userId));
            
            if (!artistDoc.exists()) {
                alert('Artist profile not found');
                window.location.href = '/artist/login';
                return;
            }

            const artistData = artistDoc.data();
            
            document.getElementById('artistName')!.textContent = artistData.artistName || 'Artist';
            document.getElementById('displayArtistName')!.textContent = artistData.artistName || 'N/A';
            document.getElementById('artistEmail')!.textContent = artistData.email || '';
            document.getElementById('artistGenre')!.textContent = artistData.genre || 'Not specified';
            document.getElementById('artistPhone')!.textContent = artistData.phone || 'Not provided';
            
            const date = new Date(artistData.registeredAt);
            document.getElementById('memberSince')!.textContent = date.toLocaleDateString();

            // Update bio
            const bioElement = document.getElementById('artistBio')!;
            if (artistData.bio) {
                bioElement.innerHTML = `<p>${artistData.bio}</p>`;
            }

            // Check upload access
            if (!artistData.hasUploadAccess) {
                const uploadStatus = document.getElementById('uploadStatus')!;
                const uploadBtn = document.getElementById('uploadPortalBtn') as HTMLAnchorElement;
                
                uploadStatus.className = 'status-badge status-inactive';
                uploadStatus.style.background = '#f8d7da';
                uploadStatus.style.color = '#721c24';
                uploadStatus.innerHTML = `
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                    </svg>
                    <span>Upload Access Disabled</span>
                `;
                
                uploadBtn.style.background = '#6c757d';
                uploadBtn.style.pointerEvents = 'none';
                uploadBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 11c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1 4h-2v-2h2v2z"/>
                    </svg>
                    Access Disabled
                `;
            }
        } catch (error) {
            console.error('Error loading artist data:', error);
            alert('Failed to load artist data');
        }
    }

    // Logout
    document.getElementById('logoutBtn')?.addEventListener('click', async () => {
        try {
            await signOut(auth);
            window.location.href = '/';
        } catch (error) {
            console.error('Error logging out:', error);
            alert('Failed to logout');
        }
    });
</script>