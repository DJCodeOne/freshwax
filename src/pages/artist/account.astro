---
// /src/pages/artist/account.astro
// My Account - Profile, orders, payouts, settings & monitoring

import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getDocument, queryCollection } from '../../lib/firebase-rest';

const partnerId = Astro.cookies.get('partnerId')?.value || '';
let partner: any = null;
let orders: any[] = [];
let orderStats = {
  total: 0,
  pending: 0,
  processed: 0,
  shipped: 0,
  delivered: 0,
  cancelled: 0
};
let salesStats = {
  totalSales: 0,
  totalRevenue: 0,
  releaseSales: 0,
  releaseRevenue: 0,
  merchSales: 0,
  merchRevenue: 0,
  totalPaidOut: 0,
  totalFeesPaid: 0
};
let activity: any[] = [];

if (partnerId) {
  try {
    const partnerDoc = await getDocument('artists', partnerId);
    if (partnerDoc) {
      partner = { id: partnerId, ...partnerDoc };

      // If no avatar in artists collection, try to get from customers collection
      if (!partner.avatarUrl && !partner.imageUrl && !partner.photoURL) {
        try {
          const customerData = await getDocument('customers', partnerId);
          if (customerData) {
            partner.avatarUrl = customerData?.avatarUrl || customerData?.photoURL || null;
          }
        } catch (e) {
          // Ignore errors fetching customer avatar
        }
      }

      // Fetch orders for this partner
      orders = await queryCollection('orders', {
        filters: [{ field: 'artistId', op: 'EQUAL', value: partnerId }],
        orderBy: { field: 'createdAt', direction: 'DESCENDING' },
        limit: 50
      });

      // Calculate order stats
      orders.forEach(order => {
        orderStats.total++;
        const status = (order.status || 'pending').toLowerCase();
        if (status === 'pending') orderStats.pending++;
        else if (status === 'processed' || status === 'processing') orderStats.processed++;
        else if (status === 'shipped') orderStats.shipped++;
        else if (status === 'delivered') orderStats.delivered++;
        else if (status === 'cancelled') orderStats.cancelled++;

        // Calculate sales
        const orderTotal = order.total || order.amount || 0;
        salesStats.totalRevenue += orderTotal;
        salesStats.totalSales++;

        if (order.type === 'release' || order.type === 'music') {
          salesStats.releaseSales++;
          salesStats.releaseRevenue += orderTotal;
        } else if (order.type === 'merch' || order.type === 'merchandise') {
          salesStats.merchSales++;
          salesStats.merchRevenue += orderTotal;
        }
      });

      // Calculate payouts - artists get paid at checkout
      // 70% goes to artist, 30% is fees (payment processing + Fresh Wax)
      salesStats.totalPaidOut = salesStats.totalRevenue * 0.7;
      salesStats.totalFeesPaid = salesStats.totalRevenue * 0.3;

      // Recent activity (combine from various sources)
      activity = orders.slice(0, 10).map(order => ({
        type: 'order',
        title: `New ${order.type || 'order'} sale`,
        description: order.itemTitle || order.title || 'Order placed',
        date: order.createdAt,
        amount: order.total || order.amount
      }));
    }
  } catch (e) {
    console.error('Error fetching account data:', e);
  }
}

const isLoggedIn = !!partner;

const formatDate = (dateStr: string) => {
  if (!dateStr) return 'Unknown';
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
};

const formatDateTime = (dateStr: string) => {
  if (!dateStr) return 'Unknown';
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-GB', { 
    day: 'numeric', 
    month: 'short', 
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};

const formatPrice = (price: number) => {
  return new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }).format(price || 0);
};

const formatNumber = (num: number) => new Intl.NumberFormat('en-GB').format(num || 0);

const getStatusClass = (status: string) => {
  const s = (status || 'pending').toLowerCase();
  if (s === 'delivered') return 'delivered';
  if (s === 'shipped') return 'shipped';
  if (s === 'processed' || s === 'processing') return 'processed';
  if (s === 'cancelled') return 'cancelled';
  return 'pending';
};

export const prerender = false;
---

<Layout title="My Account">
  <Header />
  
  <main class="account-main">
    <div class="container">
      {!isLoggedIn ? (
        <div class="login-prompt">
          <p>Please log in to view your account.</p>
          <a href="/login" class="login-btn">Sign In</a>
        </div>
      ) : (
        <>
          <!-- Page Header -->
          <div class="page-header">
            <div class="header-left">
              <a href="/artist/dashboard" class="back-link">‚Üê Dashboard</a>
              <h1>My Account</h1>
              <p>Manage your profile, orders and settings</p>
            </div>
            <div class="header-actions">
              <button class="print-btn" onclick="window.print()">
                üñ®Ô∏è Print Report
              </button>
            </div>
          </div>

          <!-- Profile Section -->
          <section class="account-section">
            <div class="section-header">
              <h2>üë§ Profile</h2>
              <button class="edit-profile-btn" id="edit-profile-btn">{partner.bio ? '‚úèÔ∏è Edit Bio' : '‚ûï Add Bio'}</button>
            </div>
            
            <div class="profile-card">
              <div class="profile-view" id="profile-view">
                <div class="profile-avatar">
                  {partner.avatarUrl || partner.imageUrl || partner.photoURL ? (
                    <img src={partner.avatarUrl || partner.imageUrl || partner.photoURL} alt={partner.artistName} onerror="this.style.display='none';this.nextElementSibling.style.display='flex';" />
                    <span style="display:none;">{(partner.artistName || 'A')[0].toUpperCase()}</span>
                  ) : (
                    <span>{(partner.artistName || 'A')[0].toUpperCase()}</span>
                  )}
                </div>
                <div class="profile-info">
                  <h3>{partner.artistName || partner.name || 'Artist'}</h3>
                  <p class="profile-email">{partner.email}</p>
                  <div class="profile-meta">
                    <span class="meta-badge">{partner.role || 'Artist'}</span>
                    <span class={`status-badge ${partner.approved ? 'approved' : 'pending'}`}>
                      {partner.approved ? '‚úì Approved' : '‚è≥ Pending'}
                    </span>
                    <span class="meta-item">Joined {formatDate(partner.createdAt)}</span>
                  </div>
                  {partner.bio ? (
                    <p class="profile-bio">{partner.bio}</p>
                  ) : (
                    <p class="profile-bio empty">No bio added yet. Click "Add Bio" to tell people about yourself.</p>
                  )}
                </div>
              </div>
              
              <div class="profile-edit hidden" id="profile-edit">
                <div class="edit-form">
                  <div class="form-field">
                    <label>Bio</label>
                    <textarea id="edit-bio" rows="4" maxlength="200" placeholder="Tell people about yourself, your music, or your label...">{partner.bio || ''}</textarea>
                    <span class="char-count"><span id="bio-count">{(partner.bio || '').length}</span>/200</span>
                  </div>
                  <div class="form-actions">
                    <button class="cancel-btn" id="cancel-profile">Cancel</button>
                    <button class="save-btn" id="save-profile">Save Bio</button>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Payment Setup Section -->
          <section class={`account-section stripe-section ${(partner.stripeConnectStatus === 'active' || partner.paypalEmail) ? 'payment-complete' : ''}`} id="stripe-connect-section" data-collapsed={(partner.stripeConnectStatus === 'active' || partner.paypalEmail) ? 'true' : 'false'}>
            <div class="section-header clickable" id="payment-section-toggle">
              <div class="header-left">
                <h2>üè¶ Payment Setup</h2>
                {(partner.stripeConnectStatus === 'active' || partner.paypalEmail) && (
                  <span class="setup-complete-badge">‚úì Connected</span>
                )}
              </div>
              <div class="header-right">
                {(partner.stripeConnectStatus === 'active' || partner.paypalEmail) && (
                  <div class="payout-method-badge">
                    Preferred: <strong>{partner.payoutMethod === 'paypal' ? 'PayPal' : 'Stripe'}</strong>
                  </div>
                )}
                {(partner.stripeConnectStatus === 'active' || partner.paypalEmail) && (
                  <button class="collapse-toggle" id="payment-collapse-btn" aria-label="Toggle payment section">
                    <span class="collapse-icon">‚ñº</span>
                  </button>
                )}
              </div>
            </div>

            <!-- Collapsible Content -->
            <div class="payment-content" id="payment-content">
            <!-- Payout Method Tabs -->
            <div class="payout-tabs">
              <button class="payout-tab active" data-tab="stripe">
                <span class="tab-icon">üí≥</span> Stripe <span class="tab-recommended">Recommended</span>
                {partner.stripeConnectStatus === 'active' && <span class="tab-check">‚úì</span>}
              </button>
              <button class="payout-tab" data-tab="paypal">
                <span class="tab-icon">üÖøÔ∏è</span> PayPal <span class="tab-fee">+2% fee</span>
                {partner.paypalEmail && <span class="tab-check">‚úì</span>}
              </button>
            </div>

            <!-- Stripe Tab Content -->
            <div class="payout-tab-content active" id="stripe-tab">
              {partner.stripeConnectStatus === 'active' ? (
                <div class="stripe-status connected">
                  <div class="status-icon">‚úì</div>
                  <div class="status-info">
                    <h3>Stripe Connected</h3>
                    <p>Your account is set up to receive automatic payouts when customers purchase your music.</p>
                    <div class="stripe-badges">
                      <span class="stripe-badge active">Charges Enabled</span>
                      <span class="stripe-badge active">Payouts Enabled</span>
                    </div>
                  </div>
                  <div class="status-actions">
                    <a href="https://dashboard.stripe.com/express" target="_blank" rel="noopener noreferrer" class="stripe-dashboard-btn">
                      Stripe Dashboard ‚Üí
                    </a>
                    {partner.payoutMethod !== 'stripe' && partner.paypalEmail && (
                      <button class="set-preferred-btn" data-method="stripe">Set as Preferred</button>
                    )}
                  </div>
                </div>
              ) : partner.stripeConnectStatus === 'onboarding' || partner.stripeConnectStatus === 'restricted' ? (
                <div class="stripe-status incomplete">
                  <div class="status-icon">‚è≥</div>
                  <div class="status-info">
                    <h3>Setup Incomplete</h3>
                    <p>Your Stripe account setup isn't complete. Please continue to finish receiving payments.</p>
                    {partner.stripeConnectStatus === 'restricted' && (
                      <p class="warning-text">Your account has restrictions. Click continue to resolve them.</p>
                    )}
                  </div>
                  <div class="status-actions">
                    <button class="stripe-continue-btn" id="stripe-continue-btn">
                      Continue Setup ‚Üí
                    </button>
                  </div>
                </div>
              ) : (
                <div class="stripe-status not-started">
                  <div class="status-icon">üí≥</div>
                  <div class="status-info">
                    <h3>Connect with Stripe</h3>
                    <p>Link your bank account via Stripe to receive payouts. You keep 99% of every sale!</p>
                    <ul class="stripe-benefits">
                      <li>‚úì <strong>No payout fees</strong> - keep more of your earnings</li>
                      <li>‚úì Direct bank deposits in 2-3 days</li>
                      <li>‚úì View earnings in Stripe Dashboard</li>
                    </ul>
                  </div>
                  <div class="status-actions">
                    <button class="stripe-connect-btn" id="stripe-connect-btn">
                      Connect with Stripe
                    </button>
                  </div>
                </div>
              )}
            </div>

            <!-- PayPal Tab Content -->
            <div class="payout-tab-content" id="paypal-tab">
              {partner.paypalEmail ? (
                <div class="stripe-status connected">
                  <div class="status-icon">‚úì</div>
                  <div class="status-info">
                    <h3>PayPal Connected</h3>
                    <p>Payouts will be sent to: <strong>{partner.paypalEmail}</strong></p>
                    <p class="small-text">Linked on {formatDate(partner.paypalLinkedAt)}</p>
                  </div>
                  <div class="status-actions">
                    <button class="paypal-change-btn" id="paypal-change-btn">Change Email</button>
                    {partner.payoutMethod !== 'paypal' && partner.stripeConnectStatus === 'active' && (
                      <button class="set-preferred-btn" data-method="paypal">Set as Preferred</button>
                    )}
                  </div>
                </div>
              ) : (
                <div class="stripe-status not-started paypal-setup">
                  <div class="status-icon">üÖøÔ∏è</div>
                  <div class="status-info">
                    <h3>Link PayPal Account</h3>
                    <p>Enter your PayPal email to receive payouts via PayPal.</p>
                    <p class="paypal-fee-note">Note: PayPal charges a 2% payout fee. We recommend Stripe for lower fees.</p>
                    <div class="paypal-form">
                      <input type="email" id="paypal-email-input" placeholder="your@paypal-email.com" />
                      <button class="paypal-link-btn" id="paypal-link-btn">Link PayPal</button>
                    </div>
                  </div>
                </div>
              )}
            </div>
            </div><!-- end payment-content -->

            {partner.pendingBalance > 0 && !partner.stripeConnectStatus && !partner.paypalEmail && (
              <div class="pending-earnings-notice">
                <span class="notice-icon">üí∞</span>
                <div class="notice-content">
                  <strong>You have {formatPrice(partner.pendingBalance)} in pending earnings!</strong>
                  <p>Set up Stripe or PayPal to receive your payouts.</p>
                </div>
              </div>
            )}
          </section>

          <!-- Vinyl Shipping Settings -->
          <section class="account-section" id="vinyl-shipping-section">
            <div class="section-header">
              <h2>üì¶ Vinyl Shipping Rates</h2>
              <p class="section-subtitle">Set your default shipping rates for vinyl releases. You can override these per-release.</p>
            </div>

            <div class="shipping-settings-grid">
              <div class="shipping-card">
                <div class="shipping-region">
                  <span class="region-flag">üá¨üáß</span>
                  <span class="region-name">UK</span>
                </div>
                <div class="shipping-input-group">
                  <span class="currency">¬£</span>
                  <input
                    type="number"
                    id="shipping-uk"
                    class="shipping-input"
                    value={partner.vinylShippingUK || ''}
                    placeholder="0.00"
                    step="0.01"
                    min="0"
                  />
                </div>
              </div>

              <div class="shipping-card">
                <div class="shipping-region">
                  <span class="region-flag">üá™üá∫</span>
                  <span class="region-name">Europe</span>
                </div>
                <div class="shipping-input-group">
                  <span class="currency">¬£</span>
                  <input
                    type="number"
                    id="shipping-eu"
                    class="shipping-input"
                    value={partner.vinylShippingEU || ''}
                    placeholder="0.00"
                    step="0.01"
                    min="0"
                  />
                </div>
              </div>

              <div class="shipping-card">
                <div class="shipping-region">
                  <span class="region-flag">üåç</span>
                  <span class="region-name">International</span>
                </div>
                <div class="shipping-input-group">
                  <span class="currency">¬£</span>
                  <input
                    type="number"
                    id="shipping-intl"
                    class="shipping-input"
                    value={partner.vinylShippingIntl || ''}
                    placeholder="0.00"
                    step="0.01"
                    min="0"
                  />
                </div>
              </div>
            </div>

            <div class="shipping-location">
              <label for="ships-from">Ships From:</label>
              <input
                type="text"
                id="ships-from"
                class="ships-from-input"
                value={partner.vinylShipsFrom || ''}
                placeholder="e.g. London, UK"
              />
            </div>

            <div class="shipping-actions">
              <button id="save-shipping-btn" class="btn-primary">Save Shipping Rates</button>
              <span id="shipping-save-status" class="save-status"></span>
            </div>

            <div class="shipping-info-box">
              <span class="info-icon">‚ÑπÔ∏è</span>
              <div class="info-content">
                <strong>How shipping works:</strong>
                <p>When a customer buys vinyl from you, they pay your shipping rate based on their location. You receive 100% of the shipping fee along with the item price.</p>
                <p>If a customer orders vinyl from multiple artists, they pay each artist's shipping separately (items ship from different locations).</p>
              </div>
            </div>
          </section>

          <!-- Sales Overview -->
          <section class="account-section">
            <div class="section-header">
              <h2>üí∞ Sales Overview</h2>
            </div>
            
            <div class="stats-grid">
              <div class="stat-card highlight">
                <div class="stat-icon">üõí</div>
                <div class="stat-value">{formatNumber(salesStats.totalSales)}</div>
                <div class="stat-label">Total Sales</div>
              </div>
              <div class="stat-card green">
                <div class="stat-icon">üí∑</div>
                <div class="stat-value">{formatPrice(salesStats.totalRevenue)}</div>
                <div class="stat-label">Total Revenue</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">üíø</div>
                <div class="stat-value">{formatNumber(salesStats.releaseSales)}</div>
                <div class="stat-label">Release Sales</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">üëï</div>
                <div class="stat-value">{formatNumber(salesStats.merchSales)}</div>
                <div class="stat-label">Merch Sales</div>
              </div>
            </div>
          </section>

          <!-- Orders Section -->
          <section class="account-section">
            <div class="section-header">
              <h2>üì¶ Orders</h2>
              <div class="order-badges">
                <span class="order-badge pending">{orderStats.pending} Pending</span>
                <span class="order-badge processed">{orderStats.processed} Processed</span>
                <span class="order-badge shipped">{orderStats.shipped} Shipped</span>
                <span class="order-badge delivered">{orderStats.delivered} Delivered</span>
              </div>
            </div>
            
            {orders.length === 0 ? (
              <div class="empty-box">
                <p>No orders yet</p>
              </div>
            ) : (
              <div class="orders-table-wrap">
                <table class="orders-table">
                  <thead>
                    <tr>
                      <th>Order ID</th>
                      <th>Date</th>
                      <th>Customer</th>
                      <th>Item</th>
                      <th>Amount</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {orders.slice(0, 20).map(order => (
                      <tr>
                        <td class="order-id">#{order.id.slice(-8).toUpperCase()}</td>
                        <td>{formatDate(order.createdAt)}</td>
                        <td>{order.customerName || order.customer?.name || 'Customer'}</td>
                        <td class="item-cell">{order.itemTitle || order.title || order.items?.[0]?.title || '-'}</td>
                        <td class="amount">{formatPrice(order.total || order.amount || 0)}</td>
                        <td>
                          <span class={`status-pill ${getStatusClass(order.status)}`}>
                            {order.status || 'Pending'}
                          </span>
                        </td>
                        <td>
                          <button class="table-btn" data-order-id={order.id}>View</button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </section>

          <!-- Payouts Section -->
          <section class="account-section">
            <div class="section-header">
              <h2>üí≥ Payouts</h2>
            </div>
            
            <div class="payout-cards">
              <div class="payout-card paid">
                <div class="payout-label">Total Paid Out</div>
                <div class="payout-value">{formatPrice(salesStats.totalPaidOut)}</div>
                <div class="payout-note">Your earnings after fees</div>
              </div>
              <div class="payout-card fees">
                <div class="payout-label">Total Fees Paid</div>
                <div class="payout-value">{formatPrice(salesStats.totalFeesPaid)}</div>
                <div class="payout-note">Payment processing + Website maintenance</div>
              </div>
            </div>
            
            <div class="payout-info">
              <p>üí° You get paid instantly at checkout.</p>
              <p>üìß Fees cover payment processing and website maintenance.</p>
            </div>
          </section>

          <!-- Activity Monitor -->
          <section class="account-section">
            <div class="section-header">
              <h2>üìä Recent Activity</h2>
            </div>
            
            {activity.length === 0 ? (
              <div class="empty-box">
                <p>No recent activity</p>
              </div>
            ) : (
              <div class="activity-list">
                {activity.map(item => (
                  <div class="activity-item">
                    <div class="activity-icon">
                      {item.type === 'order' ? 'üõí' : 'üìå'}
                    </div>
                    <div class="activity-content">
                      <div class="activity-title">{item.title}</div>
                      <div class="activity-desc">{item.description}</div>
                    </div>
                    <div class="activity-meta">
                      {item.amount && <span class="activity-amount">{formatPrice(item.amount)}</span>}
                      <span class="activity-date">{formatDateTime(item.date)}</span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </section>

          <!-- Account Settings -->
          <section class="account-section">
            <div class="section-header">
              <h2>üîß Settings</h2>
            </div>
            
            <div class="settings-grid">
              <div class="setting-item">
                <div class="setting-info">
                  <h4>Download Data</h4>
                  <p>Export all your account data</p>
                </div>
                <button class="download-data-btn" id="download-data">Download</button>
              </div>
            </div>
          </section>
        </>
      )}
    </div>
  </main>

  <Footer />
</Layout>

<style>
  .account-main {
    min-height: calc(100vh - 200px);
    background: linear-gradient(to bottom, #000000, #111827);
    padding: 2rem 0;
  }
  
  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }
  
  /* Page Header */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
  }
  
  .header-left h1 {
    font-family: 'Inter', sans-serif; font-weight: 700;
    font-size: 2.5rem;
    color: #fff;
    margin: 0.5rem 0 0.25rem;
  }
  
  .header-left p {
    color: #9ca3af;
    font-size: 1.0625rem;
  }
  
  .back-link {
    color: #9ca3af;
    text-decoration: none;
    font-size: 0.9375rem;
    font-weight: 500;
  }
  
  .back-link:hover { color: #fff; }
  
  .print-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(to bottom, #1f2937, #111827);
    color: #fff;
    padding: 0.875rem 1.5rem;
    border-radius: 10px;
    border: 2px solid #374151;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .print-btn:hover {
    background: linear-gradient(to bottom, #374151, #1f2937);
    border-color: #4b5563;
  }
  
  /* Login Prompt */
  .login-prompt {
    background: linear-gradient(to bottom, #1f2937, #111827);
    border: 2px solid #374151;
    border-radius: 16px;
    padding: 4rem 2rem;
    text-align: center;
  }
  
  .login-btn {
    display: inline-block;
    background: #000;
    color: #fff;
    padding: 0.875rem 2rem;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
  }
  
  /* Account Sections */
  .account-section {
    background: linear-gradient(to bottom, #1f2937, #111827);
    border: 2px solid #374151;
    border-radius: 16px;
    padding: 1.75rem;
    margin-bottom: 1.5rem;
  }
  
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
  }
  
  .section-header h2 {
    font-family: 'Inter', sans-serif; font-weight: 700;
    font-size: 1.5rem;
    color: #fff;
    margin: 0;
  }
  
  .edit-profile-btn {
    background: linear-gradient(to bottom, #374151, #1f2937);
    border: 2px solid #4b5563;
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.9375rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .edit-profile-btn:hover { background: linear-gradient(to bottom, #4b5563, #374151); border-color: #6b7280; }
  
  /* Profile Card */
  .profile-card {
    position: relative;
  }
  
  .profile-view {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
  }
  
  .profile-view.hidden { display: none; }
  
  .profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: linear-gradient(135deg, #000, #333);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    overflow: hidden;
  }
  
  .profile-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .profile-avatar span {
    font-family: 'Inter', sans-serif; font-weight: 700;
    font-size: 2.5rem;
    color: #fff;
  }
  
  .profile-info h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0 0 0.25rem;
    color: #fff;
  }
  
  .profile-email {
    color: #9ca3af;
    font-size: 1rem;
    margin: 0 0 0.75rem;
  }
  
  .profile-meta {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    margin-bottom: 1rem;
    align-items: center;
  }
  
  .meta-badge {
    background: linear-gradient(to bottom, #374151, #1f2937);
    color: #fff;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8125rem;
    font-weight: 600;
    text-transform: uppercase;
    border: 1px solid #4b5563;
  }
  
  .status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8125rem;
    font-weight: 600;
  }
  
  .status-badge.approved { background: rgba(22, 163, 74, 0.2); color: #22c55e; border: 1px solid #22c55e; }
  .status-badge.pending { background: rgba(217, 119, 6, 0.2); color: #fbbf24; border: 1px solid #fbbf24; }
  
  .meta-item {
    font-size: 0.875rem;
    color: #9ca3af;
  }
  
  .profile-bio {
    color: #e5e7eb;
    font-size: 1rem;
    line-height: 1.5;
    margin: 0;
  }
  
  .profile-bio.empty {
    color: #6b7280;
    font-style: italic;
    font-size: 0.9rem;
  }
  
  /* Profile Edit */
  .profile-edit.hidden { display: none; }
  
  .edit-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }
  
  .form-field {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .form-field label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #e5e7eb;
  }
  
  .form-field input,
  .form-field textarea {
    padding: 0.75rem 1rem;
    border: 2px solid #374151;
    border-radius: 10px;
    font-size: 1rem;
    font-family: inherit;
    transition: border-color 0.2s;
    background: #fff;
    color: #111827;
  }
  
  .form-field input:focus,
  .form-field textarea:focus {
    outline: none;
    border-color: #dc2626;
  }
  
  .form-field input:disabled {
    background: #1f2937;
    color: #9ca3af;
    border-color: #374151;
  }
  
  .char-count {
    font-size: 0.8125rem;
    color: #9ca3af;
    text-align: right;
  }
  
  .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
    margin-top: 0.5rem;
  }
  
  .cancel-btn {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(to bottom, #1f2937, #111827);
    border: 2px solid #374151;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    color: #9ca3af;
    cursor: pointer;
  }
  
  .cancel-btn:hover { background: linear-gradient(to bottom, #374151, #1f2937); border-color: #4b5563; color: #fff; }
  
  .save-btn {
    padding: 0.75rem 1.5rem;
    background: #000;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    color: #fff;
    cursor: pointer;
  }
  
  .save-btn:hover { background: #222; }
  
  /* Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
  }
  
  .stat-card {
    background: linear-gradient(to bottom, #1f2937, #111827);
    border: 2px solid #374151;
    border-radius: 12px;
    padding: 1.25rem;
    text-align: center;
  }
  
  .stat-card.highlight {
    background: #000;
    border-color: #4b5563;
  }
  
  .stat-card.highlight .stat-value,
  .stat-card.highlight .stat-label { color: #fff; }
  
  .stat-card.green {
    background: rgba(16, 185, 129, 0.1);
    border-color: #10b981;
  }
  
  .stat-card.green .stat-value { color: #22c55e; }
  
  .stat-icon { font-size: 1.25rem; margin-bottom: 0.5rem; }
  
  .stat-value {
    font-family: 'Inter', sans-serif; font-weight: 700;
    font-size: 2rem;
    line-height: 1;
    color: #fff;
  }
  
  .stat-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #9ca3af;
    text-transform: uppercase;
    margin-top: 0.25rem;
  }
  
  /* Order Badges */
  .order-badges {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .order-badge {
    padding: 0.375rem 0.875rem;
    border-radius: 20px;
    font-size: 0.8125rem;
    font-weight: 700;
  }
  
  .order-badge.pending { background: rgba(217, 119, 6, 0.2); color: #fbbf24; border: 1px solid #fbbf24; }
  .order-badge.processed { background: rgba(37, 99, 235, 0.2); color: #60a5fa; border: 1px solid #60a5fa; }
  .order-badge.shipped { background: rgba(79, 70, 229, 0.2); color: #a5b4fc; border: 1px solid #a5b4fc; }
  .order-badge.delivered { background: rgba(22, 163, 74, 0.2); color: #22c55e; border: 1px solid #22c55e; }
  
  /* Orders Table */
  .orders-table-wrap {
    overflow-x: auto;
  }
  
  .orders-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9375rem;
  }
  
  .orders-table th {
    text-align: left;
    padding: 0.875rem 1rem;
    background: linear-gradient(to bottom, #000000, #111827);
    font-weight: 700;
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    color: #9ca3af;
    border-bottom: 2px solid #374151;
  }
  
  .orders-table td {
    padding: 1rem;
    border-bottom: 1px solid #374151;
    color: #e5e7eb;
  }
  
  .order-id {
    font-family: monospace;
    font-weight: 600;
    color: #9ca3af;
  }
  
  .item-cell {
    max-width: 200px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .amount {
    font-weight: 700;
    color: #16a34a;
  }
  
  .status-pill {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8125rem;
    font-weight: 600;
    text-transform: capitalize;
  }
  
  .status-pill.pending { background: rgba(217, 119, 6, 0.2); color: #fbbf24; }
  .status-pill.processed { background: rgba(37, 99, 235, 0.2); color: #60a5fa; }
  .status-pill.shipped { background: rgba(79, 70, 229, 0.2); color: #a5b4fc; }
  .status-pill.delivered { background: rgba(22, 163, 74, 0.2); color: #22c55e; }
  .status-pill.cancelled { background: rgba(220, 38, 38, 0.2); color: #f87171; }
  
  .table-btn {
    padding: 0.375rem 0.875rem;
    background: linear-gradient(to bottom, #374151, #1f2937);
    border: 1px solid #4b5563;
    color: #fff;
    border-radius: 6px;
    font-size: 0.8125rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .table-btn:hover {
    background: linear-gradient(to bottom, #4b5563, #374151);
    border-color: #6b7280;
  }
  
  .empty-box {
    text-align: center;
    padding: 2rem;
    color: #9ca3af;
    background: linear-gradient(to bottom, #1f2937, #111827);
    border: 2px solid #374151;
    border-radius: 10px;
  }
  
  /* Payout Cards */
  .payout-cards {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  
  .payout-card {
    padding: 1.5rem;
    border-radius: 12px;
    text-align: center;
  }
  
  .payout-card.paid {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: #fff;
  }
  
  .payout-card.fees {
    background: linear-gradient(135deg, #f97316, #ea580c);
    color: #fff;
  }
  
  .payout-label {
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    opacity: 0.8;
  }
  
  .payout-value {
    font-family: 'Inter', sans-serif; font-weight: 700;
    font-size: 2.5rem;
    line-height: 1;
    margin: 0.5rem 0;
  }
  
  .payout-note {
    font-size: 0.8125rem;
    opacity: 0.7;
  }
  
  .payout-info {
    background: linear-gradient(to bottom, #1f2937, #111827);
    border: 2px solid #374151;
    border-radius: 10px;
    padding: 1rem 1.25rem;
  }
  
  .payout-info p {
    margin: 0.5rem 0;
    font-size: 0.9375rem;
    color: #9ca3af;
  }
  
  /* Activity List */
  .activity-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .activity-item {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    background: linear-gradient(to bottom, #374151, #1f2937);
    border: 1px solid #4b5563;
    border-radius: 10px;
    align-items: center;
  }
  
  .activity-icon {
    font-size: 1.5rem;
    width: 40px;
    text-align: center;
    flex-shrink: 0;
  }
  
  .activity-content {
    flex: 1;
    min-width: 0;
  }
  
  .activity-title {
    font-weight: 600;
    color: #fff;
  }
  
  .activity-desc {
    font-size: 0.875rem;
    color: #9ca3af;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .activity-meta {
    text-align: right;
    flex-shrink: 0;
  }
  
  .activity-amount {
    display: block;
    font-weight: 700;
    color: #22c55e;
  }
  
  .activity-date {
    display: block;
    font-size: 0.8125rem;
    color: #9ca3af;
  }
  
  /* Settings */
  .settings-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  .setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: linear-gradient(to bottom, #374151, #1f2937);
    border: 1px solid #4b5563;
    border-radius: 10px;
  }
  
  .setting-info h4 {
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 0.25rem;
  }
  
  .setting-info p {
    font-size: 0.875rem;
    color: #9ca3af;
    margin: 0;
  }
  
  .download-data-btn {
    padding: 0.75rem 1.5rem;
    background: #000;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    color: #fff;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .download-data-btn:hover { background: #222; }
  
  .download-data-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
  }

  /* Stripe Connect Section */
  .stripe-section {
    background: linear-gradient(to bottom, #1e293b, #0f172a);
    border-color: #6366f1;
  }

  /* Collapsible Payment Section */
  .stripe-section.payment-complete .section-header.clickable {
    cursor: pointer;
    user-select: none;
  }

  .stripe-section .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .stripe-section .header-left {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .stripe-section .header-left h2 {
    margin: 0;
  }

  .stripe-section .header-right {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .setup-complete-badge {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .collapse-toggle {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }

  .collapse-toggle:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  .collapse-icon {
    color: white;
    font-size: 0.8rem;
    transition: transform 0.3s ease;
  }

  .stripe-section[data-collapsed="true"] .collapse-icon {
    transform: rotate(-90deg);
  }

  .payment-content {
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
    max-height: 800px;
    opacity: 1;
  }

  .stripe-section[data-collapsed="true"] .payment-content {
    max-height: 0;
    opacity: 0;
    padding-top: 0;
    padding-bottom: 0;
  }

  .stripe-connect-content {
    padding: 0.5rem 0;
  }

  .stripe-status {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
    flex-wrap: wrap;
  }

  .stripe-status .status-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    flex-shrink: 0;
  }

  .stripe-status.connected .status-icon {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: #fff;
  }

  .stripe-status.incomplete .status-icon {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: #fff;
  }

  .stripe-status.not-started .status-icon {
    background: linear-gradient(135deg, #6366f1, #4f46e5);
    color: #fff;
  }

  .stripe-status .status-info {
    flex: 1;
    min-width: 200px;
  }

  .stripe-status .status-info h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #fff;
    margin: 0 0 0.5rem;
  }

  .stripe-status .status-info p {
    color: #9ca3af;
    font-size: 0.9375rem;
    margin: 0 0 0.75rem;
    line-height: 1.5;
  }

  .stripe-status .warning-text {
    color: #fbbf24;
    font-size: 0.875rem;
  }

  .stripe-badges {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-top: 0.75rem;
  }

  .stripe-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .stripe-badge.active {
    background: rgba(22, 163, 74, 0.2);
    color: #22c55e;
    border: 1px solid #22c55e;
  }

  .stripe-benefits {
    list-style: none;
    padding: 0;
    margin: 0.75rem 0 0;
  }

  .stripe-benefits li {
    color: #e5e7eb;
    font-size: 0.9375rem;
    padding: 0.25rem 0;
  }

  .status-actions {
    flex-shrink: 0;
  }

  .stripe-connect-btn,
  .stripe-continue-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
  }

  .stripe-connect-btn {
    background: linear-gradient(135deg, #6366f1, #4f46e5);
    color: #fff;
  }

  .stripe-connect-btn:hover {
    background: linear-gradient(135deg, #818cf8, #6366f1);
    transform: translateY(-1px);
  }

  .stripe-continue-btn {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: #fff;
  }

  .stripe-continue-btn:hover {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    transform: translateY(-1px);
  }

  .stripe-connect-btn:disabled,
  .stripe-continue-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .stripe-dashboard-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    background: linear-gradient(to bottom, #374151, #1f2937);
    border: 2px solid #4b5563;
    color: #fff;
    text-decoration: none;
    font-size: 0.9375rem;
    font-weight: 600;
    border-radius: 10px;
    transition: all 0.2s;
  }

  .stripe-dashboard-btn:hover {
    background: linear-gradient(to bottom, #4b5563, #374151);
    border-color: #6b7280;
  }

  .pending-earnings-notice {
    display: flex;
    gap: 1rem;
    align-items: center;
    background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.1));
    border: 2px solid #f59e0b;
    border-radius: 12px;
    padding: 1rem 1.25rem;
    margin-top: 1.5rem;
  }

  .pending-earnings-notice .notice-icon {
    font-size: 2rem;
    flex-shrink: 0;
  }

  .pending-earnings-notice .notice-content strong {
    color: #fbbf24;
    font-size: 1.0625rem;
  }

  .pending-earnings-notice .notice-content p {
    margin: 0.25rem 0 0;
    color: #9ca3af;
    font-size: 0.875rem;
  }

  /* Vinyl Shipping Settings */
  .section-subtitle {
    color: #9ca3af;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  .shipping-settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .shipping-card {
    background: linear-gradient(to bottom, #1f2937, #111827);
    border: 1px solid #374151;
    border-radius: 12px;
    padding: 1.25rem;
    text-align: center;
  }

  .shipping-region {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .region-flag {
    font-size: 1.5rem;
  }

  .region-name {
    font-weight: 600;
    color: #fff;
    font-size: 1rem;
  }

  .shipping-input-group {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.25rem;
    background: #0f172a;
    border: 1px solid #374151;
    border-radius: 8px;
    padding: 0.5rem 0.75rem;
  }

  .shipping-input-group .currency {
    color: #9ca3af;
    font-weight: 600;
  }

  .shipping-input {
    background: transparent;
    border: none;
    color: #fff;
    font-size: 1.125rem;
    font-weight: 600;
    width: 80px;
    text-align: center;
    outline: none;
  }

  .shipping-input::placeholder {
    color: #4b5563;
  }

  .shipping-location {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .shipping-location label {
    color: #9ca3af;
    font-weight: 500;
  }

  .ships-from-input {
    flex: 1;
    min-width: 200px;
    background: #0f172a;
    border: 1px solid #374151;
    border-radius: 8px;
    padding: 0.75rem 1rem;
    color: #fff;
    font-size: 0.95rem;
  }

  .ships-from-input:focus {
    outline: none;
    border-color: #dc2626;
  }

  .shipping-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .save-status {
    color: #22c55e;
    font-size: 0.875rem;
  }

  .save-status.error {
    color: #ef4444;
  }

  .shipping-info-box {
    display: flex;
    gap: 1rem;
    background: linear-gradient(to bottom, #1e3a5f, #0f172a);
    border: 1px solid #1d4ed8;
    border-radius: 12px;
    padding: 1.25rem;
  }

  .shipping-info-box .info-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .shipping-info-box .info-content strong {
    color: #fff;
    display: block;
    margin-bottom: 0.5rem;
  }

  .shipping-info-box .info-content p {
    color: #9ca3af;
    font-size: 0.875rem;
    margin: 0 0 0.5rem;
    line-height: 1.5;
  }

  .shipping-info-box .info-content p:last-child {
    margin-bottom: 0;
  }

  /* Payout Method Badge */
  .payout-method-badge {
    background: linear-gradient(to bottom, #374151, #1f2937);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.875rem;
    color: #9ca3af;
    border: 1px solid #4b5563;
  }

  .payout-method-badge strong {
    color: #22c55e;
  }

  /* Payout Tabs */
  .payout-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    border-bottom: 2px solid #374151;
    padding-bottom: 0;
  }

  .payout-tab {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.5rem;
    background: transparent;
    border: none;
    color: #9ca3af;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    transition: all 0.2s;
  }

  .payout-tab:hover {
    color: #fff;
  }

  .payout-tab.active {
    color: #fff;
    border-bottom-color: #6366f1;
  }

  .payout-tab .tab-check {
    background: #22c55e;
    color: #fff;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .payout-tab .tab-recommended {
    background: #22c55e;
    color: #000;
    font-size: 0.6rem;
    font-weight: 700;
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    text-transform: uppercase;
  }

  .payout-tab .tab-fee {
    background: #f59e0b;
    color: #000;
    font-size: 0.6rem;
    font-weight: 700;
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
  }

  .paypal-fee-note {
    color: #f59e0b;
    font-size: 0.8125rem;
    margin-top: 0.5rem;
  }

  .payout-tab-content {
    display: none;
  }

  .payout-tab-content.active {
    display: block;
  }

  /* PayPal Form */
  .paypal-form {
    display: flex;
    gap: 0.75rem;
    margin-top: 1rem;
    flex-wrap: wrap;
  }

  .paypal-form input {
    flex: 1;
    min-width: 200px;
    padding: 0.875rem 1rem;
    border: 2px solid #374151;
    border-radius: 10px;
    font-size: 1rem;
    background: #1f2937;
    color: #fff;
  }

  .paypal-form input:focus {
    outline: none;
    border-color: #6366f1;
  }

  .paypal-link-btn {
    padding: 0.875rem 1.5rem;
    background: linear-gradient(135deg, #0070ba, #003087);
    color: #fff;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .paypal-link-btn:hover {
    background: linear-gradient(135deg, #003087, #001f5c);
    transform: translateY(-1px);
  }

  .paypal-link-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .paypal-change-btn {
    padding: 0.75rem 1.25rem;
    background: linear-gradient(to bottom, #374151, #1f2937);
    border: 2px solid #4b5563;
    color: #fff;
    border-radius: 10px;
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .paypal-change-btn:hover {
    background: linear-gradient(to bottom, #4b5563, #374151);
  }

  .set-preferred-btn {
    padding: 0.75rem 1.25rem;
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border: none;
    color: #fff;
    border-radius: 10px;
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .set-preferred-btn:hover {
    background: linear-gradient(135deg, #16a34a, #15803d);
    transform: translateY(-1px);
  }

  .small-text {
    font-size: 0.8125rem;
    color: #6b7280;
    margin-top: 0.25rem;
  }

  /* Print Styles */
  @media print {
    @page {
      size: A4;
      margin: 15mm 10mm;
    }
    
    * {
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
    
    body {
      background: white !important;
      color: black !important;
      font-size: 10pt !important;
    }
    
    /* Hide interactive elements */
    .header-actions,
    .edit-profile-btn,
    .form-actions,
    .table-btn,
    .download-data-btn,
    .back-link,
    .print-btn,
    button,
    nav,
    footer,
    .profile-edit {
      display: none !important;
    }
    
    /* Main container */
    .account-main {
      background: white !important;
      padding: 0 !important;
    }
    
    .container {
      max-width: 100% !important;
      padding: 0 !important;
    }
    
    /* Page header */
    .page-header {
      margin-bottom: 15px !important;
      padding-bottom: 10px !important;
      border-bottom: 2px solid #000 !important;
    }
    
    .page-header h1 {
      font-size: 18pt !important;
      color: black !important;
    }
    
    /* Sections */
    .account-section {
      break-inside: avoid !important;
      page-break-inside: avoid !important;
      box-shadow: none !important;
      border: 1px solid #ccc !important;
      margin-bottom: 15px !important;
      background: white !important;
    }
    
    .section-header {
      background: #f5f5f5 !important;
      border-bottom: 1px solid #ccc !important;
      padding: 8px 12px !important;
    }
    
    .section-header h2 {
      font-size: 12pt !important;
      color: black !important;
    }
    
    .section-content {
      padding: 12px !important;
    }
    
    /* Profile section */
    .profile-view {
      page-break-inside: avoid !important;
    }
    
    .profile-avatar {
      width: 60px !important;
      height: 60px !important;
    }
    
    .profile-name {
      font-size: 14pt !important;
      color: black !important;
    }
    
    .profile-meta span {
      font-size: 9pt !important;
      color: #666 !important;
    }
    
    /* Payout cards */
    .payout-cards {
      display: grid !important;
      grid-template-columns: repeat(3, 1fr) !important;
      gap: 10px !important;
      page-break-inside: avoid !important;
    }
    
    .payout-card {
      border: 1px solid #ccc !important;
      padding: 10px !important;
      background: #f9f9f9 !important;
    }
    
    .payout-label {
      font-size: 8pt !important;
      color: #666 !important;
    }
    
    .payout-value {
      font-size: 12pt !important;
      color: black !important;
    }
    
    /* Tables */
    .orders-table {
      width: 100% !important;
      border-collapse: collapse !important;
      font-size: 9pt !important;
    }
    
    .orders-table th {
      background: #333 !important;
      color: white !important;
      padding: 6px 8px !important;
      font-size: 8pt !important;
      text-align: left !important;
    }
    
    .orders-table td {
      padding: 5px 8px !important;
      border-bottom: 1px solid #ddd !important;
    }
    
    .orders-table tr {
      page-break-inside: avoid !important;
    }
    
    /* Print header */
    .account-main::before {
      content: "Fresh Wax Partner Account Report";
      display: block !important;
      font-size: 10pt !important;
      text-align: right !important;
      color: #666 !important;
      margin-bottom: 10px !important;
    }
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .page-header {
      flex-direction: column;
    }
    
    .profile-view {
      flex-direction: column;
      text-align: center;
      align-items: center;
    }
    
    .profile-meta {
      justify-content: center;
    }
    
    .profile-links {
      justify-content: center;
    }
    
    .form-row {
      grid-template-columns: 1fr;
    }
    
    .payout-cards {
      grid-template-columns: 1fr;
    }
    
    .order-badges {
      width: 100%;
      justify-content: flex-start;
    }
    
    .orders-table {
      font-size: 0.8125rem;
    }
    
    .orders-table th,
    .orders-table td {
      padding: 0.75rem 0.5rem;
    }
  }
</style>

<script type="module">
  function initArtistAccount() {
    console.log('[ArtistAccount] Initializing...');
    const partnerId = document.cookie.split('; ')
      .find(row => row.startsWith('partnerId='))
      ?.split('=')[1] || '';
    console.log('[ArtistAccount] Partner ID:', partnerId);

    // Edit Profile Toggle
    const editBtn = document.getElementById('edit-profile-btn');
  const profileView = document.getElementById('profile-view');
  const profileEdit = document.getElementById('profile-edit');
  const cancelBtn = document.getElementById('cancel-profile');
  const saveBtn = document.getElementById('save-profile');
  
  editBtn?.addEventListener('click', () => {
    profileView?.classList.add('hidden');
    profileEdit?.classList.remove('hidden');
  });
  
  cancelBtn?.addEventListener('click', () => {
    profileEdit?.classList.add('hidden');
    profileView?.classList.remove('hidden');
  });
  
  // Bio character count
  const bioTextarea = document.getElementById('edit-bio');
  const bioCount = document.getElementById('bio-count');
  
  bioTextarea?.addEventListener('input', () => {
    if (bioCount) bioCount.textContent = bioTextarea.value.length;
  });
  
  // Save Profile
  saveBtn?.addEventListener('click', async () => {
    const data = {
      bio: document.getElementById('edit-bio')?.value
    };
    
    saveBtn.textContent = 'Saving...';
    saveBtn.disabled = true;
    
    try {
      const response = await fetch('/api/update-partner', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: partnerId, ...data })
      });
      
      const result = await response.json();
      
      if (result.success) {
        window.location.reload();
      } else {
        alert(result.error || 'Failed to save');
      }
    } catch (e) {
      console.error('Error:', e);
      alert('Failed to save. Please try again.');
    }
    
    saveBtn.textContent = 'Save Bio';
    saveBtn.disabled = false;
  });
  
  // Payment Section Toggle (collapsible when complete)
  const paymentSection = document.getElementById('stripe-connect-section');
  const paymentToggle = document.getElementById('payment-section-toggle');
  const paymentCollapseBtn = document.getElementById('payment-collapse-btn');

  function togglePaymentSection() {
    if (!paymentSection) return;
    const isCollapsed = paymentSection.dataset.collapsed === 'true';
    paymentSection.dataset.collapsed = isCollapsed ? 'false' : 'true';
  }

  // Click on header or button to toggle
  paymentToggle?.addEventListener('click', (e) => {
    // Only toggle if payment is complete (has the toggle button)
    if (paymentCollapseBtn && paymentSection?.classList.contains('payment-complete')) {
      togglePaymentSection();
    }
  });

  // Stripe Connect - Start onboarding
  const stripeConnectBtn = document.getElementById('stripe-connect-btn');
  console.log('[ArtistAccount] Stripe Connect btn:', stripeConnectBtn);
  stripeConnectBtn?.addEventListener('click', async () => {
    console.log('[ArtistAccount] Stripe Connect btn CLICKED');
    stripeConnectBtn.textContent = 'Creating account...';
    stripeConnectBtn.disabled = true;

    try {
      const response = await fetch('/api/stripe/connect/create-account', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });

      const result = await response.json();

      if (result.success && result.onboardingUrl) {
        window.location.href = result.onboardingUrl;
      } else {
        alert(result.error || 'Failed to create Stripe account');
        stripeConnectBtn.textContent = 'Connect with Stripe';
        stripeConnectBtn.disabled = false;
      }
    } catch (e) {
      console.error('Stripe Connect error:', e);
      alert('Failed to connect with Stripe. Please try again.');
      stripeConnectBtn.textContent = 'Connect with Stripe';
      stripeConnectBtn.disabled = false;
    }
  });

  // Stripe Connect - Continue onboarding
  const stripeContinueBtn = document.getElementById('stripe-continue-btn');
  console.log('[ArtistAccount] Stripe Continue btn:', stripeContinueBtn);
  stripeContinueBtn?.addEventListener('click', async () => {
    console.log('[ArtistAccount] Stripe Continue btn CLICKED');
    stripeContinueBtn.textContent = 'Loading...';
    stripeContinueBtn.disabled = true;

    try {
      const response = await fetch('/api/stripe/connect/refresh-link', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });

      const result = await response.json();

      if (result.success && result.onboardingUrl) {
        window.location.href = result.onboardingUrl;
      } else {
        alert(result.error || 'Failed to generate onboarding link');
        stripeContinueBtn.textContent = 'Continue Setup ‚Üí';
        stripeContinueBtn.disabled = false;
      }
    } catch (e) {
      console.error('Stripe Continue error:', e);
      alert('Failed to continue setup. Please try again.');
      stripeContinueBtn.textContent = 'Continue Setup ‚Üí';
      stripeContinueBtn.disabled = false;
    }
  });

  // Check for Stripe return URL params
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('stripe_connected') === 'true') {
    // Clear the URL param
    history.replaceState({}, document.title, window.location.pathname);
    // Show success message
    const section = document.getElementById('stripe-connect-section');
    if (section) {
      const notice = document.createElement('div');
      notice.className = 'pending-earnings-notice';
      notice.style.borderColor = '#22c55e';
      notice.style.background = 'linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.1))';
      notice.innerHTML = `
        <span class="notice-icon">‚úì</span>
        <div class="notice-content">
          <strong style="color: #22c55e;">Stripe setup complete!</strong>
          <p>Your account is now ready to receive payments.</p>
        </div>
      `;
      section.appendChild(notice);
      setTimeout(() => notice.remove(), 5000);
    }
  } else if (urlParams.get('stripe_refresh') === 'true') {
    // Clear the URL param and auto-click continue
    history.replaceState({}, document.title, window.location.pathname);
    stripeContinueBtn?.click();
  }

  // Payout Method Tabs
  const payoutTabs = document.querySelectorAll('.payout-tab');
  payoutTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const tabName = tab.dataset.tab;

      // Update tab active states
      payoutTabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');

      // Update content visibility
      document.querySelectorAll('.payout-tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`${tabName}-tab`)?.classList.add('active');
    });
  });

  // PayPal Link
  const paypalLinkBtn = document.getElementById('paypal-link-btn');
  const paypalEmailInput = document.getElementById('paypal-email-input');
  console.log('[ArtistAccount] PayPal Link btn:', paypalLinkBtn);

  paypalLinkBtn?.addEventListener('click', async () => {
    console.log('[ArtistAccount] PayPal Link btn CLICKED');
    const email = paypalEmailInput?.value?.trim();

    if (!email || !email.includes('@')) {
      alert('Please enter a valid email address');
      return;
    }

    paypalLinkBtn.textContent = 'Linking...';
    paypalLinkBtn.disabled = true;

    try {
      const response = await fetch('/api/paypal/link-account', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          entityType: 'artist',
          entityId: partnerId,
          paypalEmail: email
        })
      });

      const result = await response.json();

      if (result.success) {
        window.location.reload();
      } else {
        alert(result.error || 'Failed to link PayPal');
        paypalLinkBtn.textContent = 'Link PayPal';
        paypalLinkBtn.disabled = false;
      }
    } catch (e) {
      console.error('PayPal link error:', e);
      alert('Failed to link PayPal. Please try again.');
      paypalLinkBtn.textContent = 'Link PayPal';
      paypalLinkBtn.disabled = false;
    }
  });

  // PayPal Change Email
  const paypalChangeBtn = document.getElementById('paypal-change-btn');
  paypalChangeBtn?.addEventListener('click', () => {
    const newEmail = prompt('Enter your new PayPal email:');
    if (!newEmail || !newEmail.includes('@')) {
      if (newEmail !== null) alert('Please enter a valid email address');
      return;
    }

    paypalChangeBtn.textContent = 'Updating...';
    paypalChangeBtn.disabled = true;

    fetch('/api/paypal/link-account', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        entityType: 'artist',
        entityId: partnerId,
        paypalEmail: newEmail
      })
    })
    .then(res => res.json())
    .then(result => {
      if (result.success) {
        window.location.reload();
      } else {
        alert(result.error || 'Failed to update PayPal');
        paypalChangeBtn.textContent = 'Change Email';
        paypalChangeBtn.disabled = false;
      }
    })
    .catch(e => {
      console.error('PayPal update error:', e);
      alert('Failed to update. Please try again.');
      paypalChangeBtn.textContent = 'Change Email';
      paypalChangeBtn.disabled = false;
    });
  });

  // Set Preferred Payout Method
  const preferredBtns = document.querySelectorAll('.set-preferred-btn');
  preferredBtns.forEach(btn => {
    btn.addEventListener('click', async () => {
      const method = btn.dataset.method;
      btn.textContent = 'Setting...';
      btn.disabled = true;

      try {
        const response = await fetch('/api/paypal/set-payout-method', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            entityType: 'artist',
            entityId: partnerId,
            payoutMethod: method
          })
        });

        const result = await response.json();

        if (result.success) {
          window.location.reload();
        } else {
          alert(result.error || 'Failed to set payout method');
          btn.textContent = 'Set as Preferred';
          btn.disabled = false;
        }
      } catch (e) {
        console.error('Set payout method error:', e);
        alert('Failed to update. Please try again.');
        btn.textContent = 'Set as Preferred';
        btn.disabled = false;
      }
    });
  });

  // Download Data
  const downloadBtn = document.getElementById('download-data');
  
  downloadBtn?.addEventListener('click', async () => {
    downloadBtn.textContent = 'Preparing...';
    downloadBtn.disabled = true;
    
    try {
      // Gather all visible data from the page
      const accountData = {
        exportDate: new Date().toISOString(),
        profile: {
          artistName: document.querySelector('.profile-info h3')?.textContent || '',
          email: document.querySelector('.profile-email')?.textContent || '',
          bio: document.querySelector('.profile-bio')?.textContent || ''
        },
        message: 'For a complete data export, please contact support.'
      };
      
      const blob = new Blob([JSON.stringify(accountData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `freshwax-account-data-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    } catch (e) {
      console.error('Error:', e);
      alert('Failed to download data. Please try again.');
    }
    
    downloadBtn.textContent = 'Download';
    downloadBtn.disabled = false;
  });

  // Save Vinyl Shipping Settings
  const saveShippingBtn = document.getElementById('save-shipping-btn');
  const shippingStatus = document.getElementById('shipping-save-status');

  saveShippingBtn?.addEventListener('click', async () => {
    const ukInput = document.getElementById('shipping-uk');
    const euInput = document.getElementById('shipping-eu');
    const intlInput = document.getElementById('shipping-intl');
    const shipsFromInput = document.getElementById('ships-from');

    const vinylShippingUK = ukInput?.value ? parseFloat(ukInput.value) : null;
    const vinylShippingEU = euInput?.value ? parseFloat(euInput.value) : null;
    const vinylShippingIntl = intlInput?.value ? parseFloat(intlInput.value) : null;
    const vinylShipsFrom = shipsFromInput?.value?.trim() || null;

    saveShippingBtn.textContent = 'Saving...';
    saveShippingBtn.disabled = true;
    shippingStatus.textContent = '';
    shippingStatus.className = 'save-status';

    try {
      const response = await fetch('/api/artist/update-shipping', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          artistId: partnerId,
          vinylShippingUK,
          vinylShippingEU,
          vinylShippingIntl,
          vinylShipsFrom
        })
      });

      const result = await response.json();

      if (result.success) {
        shippingStatus.textContent = '‚úì Saved';
        shippingStatus.className = 'save-status';
      } else {
        shippingStatus.textContent = result.error || 'Failed to save';
        shippingStatus.className = 'save-status error';
      }
    } catch (e) {
      console.error('Save shipping error:', e);
      shippingStatus.textContent = 'Failed to save';
      shippingStatus.className = 'save-status error';
    }

    saveShippingBtn.textContent = 'Save Shipping Rates';
    saveShippingBtn.disabled = false;
  });
  } // end initArtistAccount

  // Run on initial load and ViewTransitions navigation
  initArtistAccount();
  document.addEventListener('astro:page-load', initArtistAccount);
</script>